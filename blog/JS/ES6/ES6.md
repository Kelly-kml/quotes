---
title: ES6
date: 2024-02-13 19:49:34
categories:
  - å‰ç«¯åŸºç¡€
tags:
  - ES6
  - Promise
  - å¼‚æ­¥ç¼–ç¨‹
---

## var/let/const åŒºåˆ«

ä¸»è¦ä»ä»¥ä¸‹äº”ç‚¹å±•å¼€ï¼š

- å˜é‡æå‡
- æš‚æ—¶æ€§æ­»åŒº
- å—çº§ä½œç”¨åŸŸ
- é‡å¤å£°æ˜
- ä¿®æ”¹å£°æ˜çš„å˜é‡

### å˜é‡æå‡

`var` å­˜åœ¨å˜é‡æå‡ï¼Œå³å˜é‡å¯ä»¥åœ¨å£°æ˜ä¹‹å‰è°ƒç”¨ï¼Œå€¼ä¸º `undefined`
`let`å’Œ `const`ä¸å­˜åœ¨å˜é‡æå‡ï¼Œå³ä¸€å®šåœ¨å…ˆå£°æ˜åè°ƒç”¨

### æš‚æ—¶æ€§æ­»åŒº

`var` ä¸å­˜åœ¨æš‚æ—¶æ€§æ­»åŒº
`let`å’Œ `const` å­˜åœ¨æš‚æ—¶æ€§æ­»åŒºï¼Œåªæœ‰ç­‰åˆ°å£°æ˜å˜é‡çš„é‚£ä¸€è¡Œä»£ç å‡ºç°ï¼Œæ‰èƒ½è·å–å’Œä½¿ç”¨è¯¥å˜é‡ï¼Œå³åœ¨å£°æ˜ä¹‹å‰éƒ½æ˜¯ä¸èƒ½ä½¿ç”¨çš„ï¼Œå¤„äºæš‚æ—¶æ€§æ­»åŒº

### å—çº§ä½œç”¨åŸŸ

`var` ä¸å­˜åœ¨å—çº§ä½œç”¨åŸŸ
`let`å’Œ `const` å­˜åœ¨å—çº§ä½œç”¨åŸŸ

### é‡å¤å£°æ˜

`var` å…è®¸é‡å¤å£°æ˜å˜é‡
`let`å’Œ `const` åœ¨åŒä¸€ä¸ªä½œç”¨åŸŸä¸å…è®¸é‡å¤å£°æ˜å˜é‡

### ä¿®æ”¹å£°æ˜çš„å˜é‡

`var` å’Œ `let` å¯ä»¥ä¿®æ”¹
`const`å£°æ˜çš„æ˜¯ä¸€ä¸ªåªè¯»çš„å¸¸é‡ï¼Œä¸€æ—¦å£°æ˜äº†ï¼Œå¸¸é‡çš„å€¼å°±ä¸èƒ½æ”¹å˜äº†ã€‚

âš ï¸ `const` å®é™…ä¸Šä¿è¯çš„å¹¶ä¸æ˜¯å˜é‡çš„å€¼ä¸å¾—æ”¹åŠ¨ï¼Œè€Œæ˜¯å˜é‡æŒ‡å‘çš„é‚£ä¸ªå†…å­˜åœ°å€æ‰€ä¿å­˜çš„æ•°æ®ä¸å¾—æ”¹åŠ¨

- ç®€å•ç±»å‹çš„æ•°æ®ï¼Œå€¼ä¿å­˜åœ¨å˜é‡æŒ‡å‘çš„é‚£ä¸ªå†…å­˜åœ°å€ï¼Œå› æ­¤ç­‰åŒäºå¸¸é‡
- å¤æ‚ç±»å‹çš„æ•°æ®ï¼Œå˜é‡æŒ‡å‘çš„å†…å­˜åœ°å€ï¼Œä¿å­˜çš„åªæ˜¯ä¸€ä¸ªæŒ‡å‘å®é™…æ•°æ®çš„æŒ‡é’ˆï¼Œ`const`åªèƒ½ä¿è¯è¿™ä¸ªæŒ‡é’ˆæ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸èƒ½ç¡®ä¿å˜é‡çš„ç»“æ„ä¸å˜ï¼Œä¾‹å¦‚ï¼š

```js
const foo = {};
// å¯ä»¥ä¸ºfooæ·»åŠ æ–°å±æ€§
foo.prop = 123;
foo.prop; // 123
// å°†foo æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ä¼šæŠ¥é”™
foo = {}; // TypeError: "foo" is read-only
```

## ES6 ä¸­æ•°ç»„æ–°å¢äº†å“ªäº›æ‹“å±•

å…·ä½“æ€»ç»“ä¸ºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

- æ‰©å±•è¿ç®—ç¬¦çš„åº”ç”¨
- æ„é€ å‡½æ•°æ–°å¢çš„æ–¹æ³•
- å®ä¾‹å¯¹è±¡æ–°å¢çš„æ–¹æ³•
- ç©ºå€¼å¤„ç†
- sort()æ’åºç®—æ³•çš„ç¨³å®šæ€§

### æ‰©å±•è¿ç®—ç¬¦çš„åº”ç”¨

ES6 é€šè¿‡æ‰©å±•è¿ç®—ç¬¦`...`ï¼Œå¥½æ¯”`rest`å‚æ•°çš„é€†è¿ç®—ï¼Œå°†ä¸€ä¸ªæ•°ç»„è½¬ä¸ºç”¨é€—å·åˆ†éš”çš„å‚æ•°åºåˆ—

ä¸»è¦ç”¨äºä»¥ä¸‹å‡ ç§åº”ç”¨ï¼š

- å‡½æ•°è°ƒç”¨æ—¶ï¼Œå°†ä¸€ä¸ªæ•°ç»„å˜ä¸ºå‚æ•°åºåˆ—
- ä¹Ÿå¯ä»¥å°†æŸäº›æ•°æ®ç»“æ„è½¬ä¸ºæ•°ç»„
- èƒ½ç®€å•å®ç°æ•°ç»„çš„å¤åˆ¶ï¼ˆæµ…æ‹·è´ï¼‰
- æ•°ç»„çš„åˆå¹¶ä¹Ÿæ›´ä¸ºç®€æ´
- ä¹Ÿå¯ä»¥å°†å­—ç¬¦ä¸²è½¬ä¸ºçœŸæ­£çš„æ•°ç»„

```js
[...'hello']; //  [ "h", "e", "l", "l", "o" ]
```

- å®šä¹‰äº†éå†å™¨ï¼ˆIteratorï¼‰æ¥å£çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥ç”¨æ‰©å±•è¿ç®—ç¬¦è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼›ä½†æ˜¯å¦‚æœæ²¡æœ‰ Iterator æ¥å£çš„å¯¹è±¡ï¼Œä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼Œå°†ä¼šæŠ¥é”™

```js
let nodeList = document.querySelectorAll('div');
let array = [...nodeList];

let map = new Map([
  [1, 'one'],
  [2, 'two'],
  [3, 'three'],
]);

let arr = [...map.keys()]; // [1,2,3]

// æ²¡æœ‰Iterator
const obj = { a: 1, b: 2 };
let arr = [...obj]; // TypeError: Cannot spread non-iterable object
```

âš ï¸ æ³¨æ„ï¼š

é€šè¿‡æ‰©å±•è¿ç®—ç¬¦å®ç°çš„æ˜¯`æµ…æ‹·è´`ï¼Œä¿®æ”¹äº†å¼•ç”¨æŒ‡å‘çš„å€¼ï¼Œä¼šåŒæ­¥åæ˜ åˆ°æ–°æ•°ç»„
å¦‚æœå°†æ‰©å±•è¿ç®—ç¬¦ç”¨äºæ•°ç»„èµ‹å€¼ï¼Œåªèƒ½æ”¾åœ¨å‚æ•°çš„æœ€åä¸€ä½ï¼Œä¸ç„¶ä¼šæŠ¥é”™

### æ„é€ å‡½æ•°æ–°å¢çš„æ–¹æ³•

æ„é€ å‡½æ•°æ–°å¢çš„æ–¹æ³•æœ‰ï¼š

- Array.from()
- Array.of()

#### Array.from()

å°†ä¸¤ç±»å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼š`ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡`å’Œ`å¯éå†ï¼ˆIteratorï¼‰å¯¹è±¡`ï¼ˆåŒ…æ‹¬ ES6 æ–°å¢çš„æ•°æ®ç»“æ„ `Set` å’Œ `Map`ï¼‰

```js
let arrayLike = {
  0: 'a',
  1: 'b',
  2: 'c',
  length: 3,
};
let arr2 = Array.from(arrayLike); // ['a', 'b', 'c']
```

è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†ï¼Œå°†å¤„ç†åçš„å€¼æ”¾å…¥è¿”å›çš„æ•°ç»„ä¸­

```js
Array.from([1, 2, 3, 4], (x) => x * x); // [1,4,9,16]
```

#### Array.of()

ç”¨äºå°†ä¸€ç»„å€¼ï¼Œè½¬ä¸ºæ•°ç»„

```javascript
Array.of(3, 2, 33, 66); // [3, 2, 33, 66]
```

`Array()`

æ²¡æœ‰å‚æ•°æ—¶ï¼Œè¿”å›ä¸€ä¸ªç©ºæ•°ç»„

å½“å‚æ•°åªæœ‰ä¸€ä¸ªæ—¶ï¼Œå®é™…ä¸Šæ˜¯æŒ‡æŒ‡å®šæ•°ç»„çš„é•¿åº¦

å‚æ•°ä¸ªæ•°ä¸å°‘äº 2 ä¸ªæ—¶ï¼Œ`Array()`æ‰ä¼šè¿”å›ç”±å‚æ•°ç»„æˆçš„æ–°æ•°ç»„

```js
Array(); // []
Array(3); // [, , ,]
Array(3, 11, 8); // [3, 11, 8]
```

### å®ä¾‹å¯¹è±¡æ–°å¢çš„æ–¹æ³•

æ•°ç»„å®ä¾‹å¯¹è±¡æ–°å¢çš„æ–¹æ³•ï¼š

- copyWithin()
- find()/findIndex()
- fill()
- entries()/keys()/values()
- includes()
- flat()/flatMap()

#### copyWithin()

å°†æŒ‡å®šä½ç½®çš„æˆå‘˜å¤åˆ¶åˆ°å…¶ä»–ä½ç½®ï¼ˆä¼šè¦†ç›–åŸæœ‰æˆå‘˜ï¼‰ï¼Œç„¶åè¿”å›å½“å‰æ•°ç»„

å‚æ•°ï¼š

- targetï¼ˆå¿…éœ€ï¼‰ï¼šä»è¯¥ä½ç½®å¼€å§‹æ›¿æ¢æ•°æ®ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºå€’æ•°
- startï¼ˆå¯é€‰ï¼‰ï¼šä»è¯¥ä½ç½®å¼€å§‹è¯»å–æ•°æ®ï¼Œé»˜è®¤ä¸º 0ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºä»æœ«å°¾å¼€å§‹è®¡ç®—ã€‚
- endï¼ˆå¯é€‰ï¼‰ï¼šåˆ°è¯¥ä½ç½®å‰åœæ­¢è¯»å–æ•°æ®ï¼Œé»˜è®¤ç­‰äºæ•°ç»„é•¿åº¦ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºä»æœ«å°¾å¼€å§‹è®¡ç®—

```js
[1, 2, 3, 4, 5].copyWithin(0, 3); //å°†ä»index=3çš„ä½ç½®ç›´åˆ°æ•°ç»„ç»“æŸçš„å…ƒç´ ï¼ˆ4,5ï¼‰ï¼Œå¤åˆ¶åˆ°ä»index=0 å¼€å§‹çš„ä½ç½®ï¼Œè¦†ç›–åŸæ¥çš„ï¼ˆ1,2ï¼‰
// [4,5,3,4,5]
```

#### find()/findIndex()

`find()`ç”¨äºæ‰¾å‡ºç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°ç»„å…ƒç´ å€¼

å‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ¬¡ï¼šå½“å‰å€¼ã€å½“å‰å€¼çš„ä½ç½®å’ŒåŸæ•°ç»„

```js
[1, 4, 5, 10, 15].find((value, index, arr) => {
  return value > 11;
});
// 15
```

`findIndex()`è¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°ç»„å…ƒç´ çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶ï¼Œåˆ™è¿”å›-1

```js
[1, 4, 5, 10, 15].findIndex((value, index, arr) => {
  return value > 11;
});
// 4
```

è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šå›è°ƒå‡½æ•°çš„ `this`å¯¹è±¡

```js
function f(v) {
  return v > this.age;
}
let person = { name: 'John', age: 20 };
[10, 12, 26, 15].find(f, person); // 26
```

#### fill()

ä½¿ç”¨ç»™å®šå€¼ï¼Œå¡«å……ä¸€ä¸ªæ•°ç»„

```js
['a', 'b', 'c'].fill(7);
// [7, 7, 7]
new Array(3).fill(7);
// [7, 7, 7]
```

è¿˜å¯ä»¥æ¥å—ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œç”¨äºæŒ‡å®šå¡«å……ä½ç½®çš„å¼€å§‹å’Œç»“æŸä½ç½®ï¼Œæ“ä½œä½ç½®åŒ…æ‹¬å¼€å§‹çš„ä½ç½®ï¼Œä¸åŒ…æ‹¬ç»“æŸçš„ä½ç½®

```js
['a', 'b', 'c'].fill(7, 1, 2);
// ['a', 7, 'c']
```

âš ï¸ å¦‚æœå¡«å……çš„ç±»å‹æ—¶å¯¹è±¡ï¼Œé‚£ä¹ˆå°±æ˜¯æµ…æ‹·è´

#### entries()/keys()/values()

`keys()`ï¼šé”®åçš„éå†
`values()`ï¼šé”®å€¼çš„éå†
`entries()`ï¼šé”®å€¼å¯¹çš„éå†

#### includes()

ç”¨äºåˆ¤æ–­æ•°ç»„æ˜¯å¦åŒ…å«ç»™å®šå€¼

```js
[1, 2, 3]
  .includes(2) // true
  [(1, 2, 3)].includes(4) // false
  [(1, 2, NaN)].includes(NaN); // true
```

å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œé»˜è®¤ä¸º 0

å‚æ•°ä¸ºè´Ÿå€¼è¡¨ç¤ºå€’æ•°çš„ä½ç½®

```js
[1, 2, 3].includes(3, 3); // false
[1, 2, 3].includes(3, -1); // true
```

#### flat()/flatMap()

å°†æ•°ç»„æ‰å¹³åŒ–å¤„ç†ï¼Œè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå¯¹åŸæ•°æ®æ²¡æœ‰å½±å“

```js
[1, 2, [3, 4]].flat();
//[1,2,3,4]
```

`flat()`é»˜è®¤åªä¼šæ‹‰å¹³ä¸€å±‚ã€‚å¦‚æœéœ€è¦æ‹‰å¹³å¤šå±‚çš„åµŒå¥—æ•°ç»„ï¼Œå¯ä»¥ç»™`flat()`ä¼ å…¥å‚æ•°ï¼šå±‚æ•°ã€‚é»˜è®¤ä¸º 1

```javascript
[1, 2, [3, [4]]].flat();
// [1,2,3,[4]]

[1, 2, [3, [4]]].flat(2);
//[1,2,3,4]
```

`flatMap()`å¯¹åŸæ•°ç»„çš„æ¯ä¸ªæˆå‘˜æ‰§è¡Œä¸€ä¸ªå‡½æ•°ç›¸å½“äº `Array.prototype.map()`ï¼Œç„¶åå¯¹è¿”å›å€¼ç»„æˆçš„æ•°ç»„æ‰§è¡Œ`flat()`æ–¹æ³•ã€‚

è¯¥æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°æ•°ç»„ï¼Œä¸æ”¹å˜åŸæ¥æ•°ç»„

```js
[2, 3, 4].flatMap((x) => [x, x * 2]);
//  [2, 4, 3, 6, 4, 8]

// ç›¸å½“äº [[2,4], [3,6], [4,8]].flat()
```

`flatMap()`è¿˜æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šéå†å‡½æ•°é‡Œé¢çš„ `this`

## å‡½æ•°æ–°å¢çš„æ‰©å±•

å…·ä½“æœ‰å“ªäº›æ‰©å±•ï¼š

- å‚æ•°
- å±æ€§
- ä½œç”¨åŸŸ
- ä¸¥æ ¼æ¨¡å¼
- ç®­å¤´å‡½æ•°

### å‚æ•°

ES6 å…è®¸ä¸ºå‡½æ•°çš„å‚æ•°è®¾ç½®é»˜è®¤å€¼ï¼Œå¹¶ä¸”å‡½æ•°çš„å½¢å‚æ ‘é»˜è®¤å£°æ˜çš„ï¼Œä¸èƒ½ä½¿ç”¨`let`æˆ–`const`å†æ¬¡å£°æ˜
å‚æ•°çš„é»˜è®¤å€¼åº”è¯¥æ˜¯å‡½æ•°çš„`å°¾å‚æ•°`ï¼Œå¦‚æœä¸æ˜¯å°¾éƒ¨çš„å‚æ•°è®¾ç½®é»˜è®¤å€¼ï¼Œå®é™…ä¸Šè¿™ä¸ªå‚æ•°æ˜¯ä¸èƒ½çœç•¥çš„ã€‚

```js
function f(x = 1, y) {
 return [x, y];
}
f() // [1, undefined]
f(2) // [2, undefined]
f(, 1) //ä¼šæŠ¥é”™
f(undefined, 1) // [1, 1]
```

### å±æ€§

#### length å±æ€§ï¼š

`length`å°†è¿”å›æ²¡æœ‰æŒ‡å®šé»˜è®¤å€¼çš„å‚æ•°ä¸ªæ•°

```js
(function (a, b, c = 5) {}).length; // 2
```

`rest`å‚æ•°ä¹Ÿä¸ä¼šè®¡å…¥`length`å±æ€§

```js
(function (...args) {}).length; // 0
```

å¦‚æœè®¾ç½®äº†é»˜è®¤å€¼çš„å‚æ•°ä¸æ˜¯å°¾å‚æ•°ï¼Œé‚£ä¹ˆ length å±æ€§ä¹Ÿä¸å†è®¡å…¥åé¢çš„å‚æ•°äº†

```js
(function (a = 0, b, c) {}).length; //0
(function (a, b = 1, c = 2) {}).length; //1
(function (a, b = 1, c) {}).length; //1
(function (a, b, c) {}).length; //3
```

#### name å±æ€§ï¼š

`ES6`å¯ä»¥è¿”å›å‡½æ•°å

```js
var f = function () {};
// ES5
f.name; // ""
// ES6
f.name; // "f"
```

å¦‚æœå°†ä¸€ä¸ªå…·åå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆ`name`å±æ€§éƒ½è¿”å›è¿™ä¸ªå…·åå‡½æ•°åŸæœ¬çš„åå­—

```js
const bar = function baz() {};
console.log(bar.name); // â€™baz'
```

`Function`æ„é€ å‡½æ•°è¿”å›çš„å‡½æ•°å®ä¾‹ï¼Œ`name`å±æ€§çš„å€¼ä¸º `anonymous`

```javascript
new Function().name; // "anonymous"
```

`bind`è¿”å›çš„å‡½æ•°ï¼Œ`name`å±æ€§å€¼ä¼šåŠ ä¸Š`bound`å‰ç¼€

```javascript
function foo() {}
foo.bind({}).name; // "bound foo"

(function () {}).bind({}).name; // "bound"
```

### ä½œç”¨åŸŸ

ä¸€æ—¦è®¾ç½®äº†å‚æ•°çš„é»˜è®¤å€¼ï¼Œå‡½æ•°è¿›è¡Œå£°æ˜åˆå§‹åŒ–æ—¶ï¼Œå‚æ•°å°±ä¼šå½¢æˆä¸€ä¸ªå•ç‹¬çš„ä½œç”¨åŸŸï¼Œç­‰å¾…åˆå§‹åŒ–ç»“æŸï¼Œè¿™ä¸ªä½œç”¨åŸŸå°±ä¼šæ¶ˆå¤±ã€‚

è¿™ç§è¡Œä¸ºï¼Œåœ¨ä¸è®¾ç½®å‚æ•°é»˜è®¤å€¼æ—¶ï¼Œæ˜¯ä¸ä¼šå‡ºç°çš„

```js
let x = 1;
function f(y = x) {
  // ç­‰åŒäº let y = x
  let x = 2;
  console.log(y);
}
f(); // 1
```

âš ï¸ ä¸ºä»€ä¹ˆè¿”å›æ‰“å°çš„æ˜¯`1`ï¼Ÿ
åœ¨å½¢å‚æ—¶å£°æ˜`x`çš„å€¼èµ‹å€¼ç»™`y`ï¼Œæ‰€ä»¥åˆå§‹è¿›å…¥å‡½æ•°ï¼Œè¿˜æ²¡æ‰§è¡Œåˆ°`x`çš„æ–°èµ‹å€¼ï¼Œåªèƒ½å°†å…¨å±€çš„`=1`èµ‹å€¼ç»™`y`ï¼Œå› æ­¤ï¼Œåœ¨å‡½æ•°æ‰§è¡Œç»“æŸæ—¶ï¼š`x=2`ï¼Œ`y=1`

### ä¸¥æ ¼æ¨¡å¼

åªè¦å‡½æ•°å‚æ•°ä½¿ç”¨äº†é»˜è®¤å€¼ã€è§£æ„èµ‹å€¼ã€æˆ–è€…æ‰©å±•è¿ç®—ç¬¦ï¼Œé‚£ä¹ˆå‡½æ•°å†…å°±ä¸èƒ½æ˜¾ç¤ºè®¾å®šä¸ºä¸¥æ ¼æ¨¡å¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™

### ç®­å¤´å‡½æ•°

âš ï¸ æ³¨æ„ç‚¹ï¼š

- å‡½æ•°ä½“å†…çš„`this`å¯¹è±¡ï¼Œå°±æ˜¯å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ—¶æ‰€åœ¨çš„å¯¹è±¡
- ä¸å¯ä»¥å½“åšæ„é€ å‡½æ•°ï¼Œå³ï¼Œä¸å¯ä»¥ä½¿ç”¨`new`å‘½ä»¤ï¼Œå¦åˆ™ä¼šæŠ›é”™
- ä¸å¯ä»¥ä½¿ç”¨`arguments`å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åœ¨å‡½æ•°ä½“å†…ä¸å­˜åœ¨ã€‚å¦‚æœè¦å®ç°è¯¥åŠŸèƒ½ï¼Œå¯ä»¥ç”¨`rest`å‚æ•°ä»£æ›¿
- ä¸å¯ä»¥ä½¿ç”¨`yield`å‘½ä»¤ï¼Œä¸€å¹´æ˜¥ç®­å¤´å‡½æ•°ä¹Ÿä¸èƒ½ä½¿ç”¨`Generator`å‡½æ•°

## å¯¹è±¡æ–°å¢äº†å“ªäº›æ‰©å±•ï¼Ÿ

### super å…³é”®å­—

æˆ‘ä»¬çŸ¥é“çš„ï¼š`this`å…³é”®å­—æ€»æ˜¯æŒ‡å‘å‡½æ•°æ‰€åœ¨çš„å½“å‰å¯¹è±¡ï¼Œ`ES6`åˆæ–°å¢äº†å¦ä¸€ä¸ªç±»ä¼¼çš„å…³é”®å­—`super`ï¼ŒæŒ‡å‘å½“å‰å¯¹è±¡çš„åŸå‹å¯¹è±¡

```js
const proto = {
  foo: 'hello',
};

const obj = {
  foo: 'world',
  find() {
    return super.foo;
  },
};

Object.setPrototypeOf(obj, proto);
obj.find(); // "hello"
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå¯¹è±¡ obj.find()æ–¹æ³•ä¹‹ä¸­ï¼Œé€šè¿‡ super.foo å¼•ç”¨äº†åŸå‹å¯¹è±¡ proto çš„ foo å±æ€§ã€‚

âš ï¸ æ³¨æ„ï¼šsuper å…³é”®å­—è¡¨ç¤ºåŸå‹å¯¹è±¡æ—¶ï¼Œåªèƒ½ç”¨åœ¨å¯¹è±¡çš„æ–¹æ³•ä¹‹ä¸­ï¼Œç”¨åœ¨å…¶ä»–åœ°æ–¹éƒ½ä¼šæŠ¥é”™ã€‚

```js
// æŠ¥é”™
const obj = {
  foo: super.foo,
};

// æŠ¥é”™
const obj = {
  foo: () => super.foo,
};

// æŠ¥é”™
const obj = {
  foo: function () {
    return super.foo;
  },
};
```

ä¸Šé¢ä¸‰ç§ super çš„ç”¨æ³•éƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºå¯¹äº `JavaScript å¼•æ“`æ¥è¯´ï¼Œè¿™é‡Œçš„ super éƒ½æ²¡æœ‰ç”¨åœ¨å¯¹è±¡çš„æ–¹æ³•ä¹‹ä¸­ã€‚ç¬¬ä¸€ç§å†™æ³•æ˜¯`super`ç”¨åœ¨å±æ€§é‡Œé¢ï¼Œç¬¬äºŒç§å’Œç¬¬ä¸‰ç§å†™æ³•æ˜¯`super`ç”¨åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œç„¶åèµ‹å€¼ç»™`foo`å±æ€§ã€‚ç›®å‰ï¼Œåªæœ‰å¯¹è±¡æ–¹æ³•çš„ç®€å†™æ³•å¯ä»¥è®© `JavaScript å¼•æ“`ç¡®è®¤ï¼Œå®šä¹‰çš„æ˜¯å¯¹è±¡çš„æ–¹æ³•ã€‚

JavaScript å¼•æ“å†…éƒ¨ï¼Œ`super.foo`ç­‰åŒäº`Object.getPrototypeOf(this).fooï¼ˆå±æ€§ï¼‰`æˆ–`Object.getPrototypeOf(this).foo.call(this)ï¼ˆæ–¹æ³•ï¼‰`

```js
const proto = {
  x: 'hello',
  foo() {
    console.log(this.x);
  },
};

const obj = {
  x: 'world',
  foo() {
    super.foo();
  },
};

Object.setPrototypeOf(obj, proto);

obj.foo(); // "world"
```

ä¸Šé¢ä»£ç ä¸­ï¼Œsuper.foo æŒ‡å‘åŸå‹å¯¹è±¡ proto çš„ foo æ–¹æ³•ï¼Œä½†æ˜¯ç»‘å®šçš„ this å´è¿˜æ˜¯å½“å‰å¯¹è±¡ objï¼Œå› æ­¤è¾“å‡ºçš„å°±æ˜¯ worldã€‚

### å±æ€§åè¡¨è¾¾

å¯ä»¥é‡‡ç”¨å­—é¢é‡å®šä¹‰ï¼Œå°†è¡¨è¾¾å¼å†™åœ¨æ‹¬å·é‡Œ

ä¹Ÿå¯ä»¥ä½¿ç”¨`[]`çš„æ–¹å¼ä¹¦å†™

### æ‰©å±•è¿ç®—ç¬¦`...`

### å±æ€§çš„éå†

ES6 ä¸€å…±æœ‰ 5 ç§æ–¹æ³•å¯ä»¥éå†å¯¹è±¡çš„å±æ€§

- for...inï¼šå¾ªç¯éå†å¯¹è±¡è‡ªèº«å’Œç»§æ‰¿å¯æšä¸¾å±æ€§ï¼ˆä¸å« Symbol å±æ€§ï¼‰
- Object.keys(obj): è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…æ‹¬å¯¹è±¡è‡ªèº«ï¼ˆä¸å«ç»§æ‰¿ï¼‰æ‰€æœ‰æšä¸¾å±æ€§ï¼ˆä¸åŒ…å« Symbol å±æ€§ï¼‰çš„é”®å
- Object.getOwnPropertyNames(obj): è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡è‡ªèº«æ‰€æœ‰å±æ€§ï¼ˆä¸å« Symbol å±æ€§ï¼Œä½†æ˜¯åŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§ï¼‰çš„é”®å
- Object.getOwnPropertySymbols(obj): è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…æ‹¬å¯¹è±¡è‡ªèº«æ‰€æœ‰çš„ Symbol å±æ€§çš„é”®å
- Reflect.ownKeys(Obj): è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…æ‹¬å¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰é”®åï¼Œä¸ç®¡é”®åæ˜¯ Symbol æˆ–å­—ç¬¦ä¸²ï¼Œä¹Ÿä¸ç®¡æ˜¯å¦å¯æšä¸¾

ä¸Šè¿°éå†ï¼Œéƒ½éµå¾ªåŒæ ·çš„å±æ€§éå†çš„æ¬¡åºè§„åˆ™ï¼š

- é¦–å…ˆéå†æ‰€æœ‰æ•°å€¼é”®ï¼ŒæŒ‰ç…§æ•°å€¼å‡åºæ’åˆ—
- å…¶æ¬¡éå†æ‰€æœ‰å­—ç¬¦ä¸²é”®ï¼ŒæŒ‰ç…§åŠ å…¥æ—¶é—´å‡åºæ’åˆ—
- æœ€åéå†æ‰€æœ‰ Symbol é”®ï¼ŒæŒ‰ç…§åŠ å…¥æ—¶é—´ç”Ÿåºæ’åˆ—

```js
Reflect.ownKeys({ [Symbol()]: 0, b: 0, 10: 0, 2: 0, a: 0 });
// ['2', '10', 'b', 'a', Symbol()]
```

### å¯¹è±¡æ–°å¢çš„æ–¹æ³•

æ–°å¢çš„æ–¹æ³•æœ‰ï¼š

- Object.is()
- Object.assign()
- Object.getOwnPropertyDescriptors()
- Object.setPrototypeOf(),Object.getPrototypeOf()
- Object.keys(),Object.values(),Object.entries()
- Object.fromEntries()

#### Object.is()

ä¸¥æ ¼åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œä¸ä¸¥æ ¼æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆ===ï¼‰çš„è¡Œä¸ºåŸºæœ¬ä¸€è‡´ï¼Œä¸åŒä¹‹å¤„æœ‰ 2 ä¸ªï¼š

- `+0` ä¸ç­‰äº `-0`
- `NaN`ç­‰äºè‡ªèº«

```javascript
+0 === -0; // true
NaN === NaN; //false

Object.is(+0, -0); // false
Object.is(NaN, NaN); // true
```

#### Object.assign()

ç”¨äºå¯¹è±¡çš„åˆå¹¶ï¼Œå°†æºå¯¹è±¡`source` çš„æ‰€æœ‰å¯æšä¸¾å±æ€§ï¼Œå¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡`target`

ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç›®æ ‡å¯¹è±¡ï¼Œåé¢çš„å‚æ•°éƒ½æ˜¯æºå¯¹è±¡

```js
const target = { a: 1, b: 1 };
const source1 = { b: 2, c: 2 };
const source2 = { c: 3 };
Object.assign(target, source1, source2);
target; // {a:1, b:2, c:3}
```

âš ï¸ Object.assign()æ˜¯æµ…æ‹·è´ï¼Œé‡åˆ°åŒåå±æ€§å°±æ›¿æ¢ï¼Œå»é‡

#### Object.getOwnPropertyDescriptors()

è¿”å›æŒ‡å®šå¯¹è±¡æ‰€æœ‰è‡ªèº«å±æ€§ï¼ˆéç»§æ‰¿å±æ€§ï¼‰çš„æè¿°å¯¹è±¡

```javascript
const obj = {
  foo: 123,
  get bar() {
    return 'abc';
  },
};
Object.getOwnPropertyDescriptors(obj);
// { foo:
// { value: 123,
// writable: true,
// enumerable: true,
// configurable: true },
// bar:
// { get: [Function: get bar],
// set: undefined,
// enumerable: true,
// configurable: true } }
```

#### Object.setPrototypeOf()

ç”¨æ¥è®¾ç½®ä¸€ä¸ªå¯¹è±¡çš„åŸå‹å¯¹è±¡

#### Object.getPrototypeOf()

ç”¨æ¥è¯»å–ä¸€ä¸ªå¯¹è±¡çš„åŸå‹å¯¹è±¡

#### Object.keys()

è¿”å›è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†ï¼ˆenumerableï¼‰å±æ€§çš„é”®åçš„æ•°ç»„

#### Object.values()

è¿”å›è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†ï¼ˆenumerableï¼‰å±æ€§çš„é”®å¯¹åº”çš„æ•°ç»„

#### Object.entries()

è¿”å›ä¸€ä¸ªå¯¹è±¡è‡ªèº«çš„ï¼ˆä¸å«ç»§æ‰¿çš„ï¼‰æ‰€æœ‰å¯éå†ï¼ˆenumerableï¼‰å±æ€§çš„é”®å€¼å¯¹çš„æ•°ç»„

#### Object.fromEntries()

è¿”å›å°†ä¸€ä¸ªé”®å€¼å¯¹æ•°ç»„è½¬ä¸ºå¯¹è±¡

```js
Object.fromEntries([
  ['foo', 'bar'],
  ['baz', 42],
]);
// { foo: "bar", baz: 42 }
```

## Promise

![å¼‚æ­¥ç¼–ç¨‹ä¹‹Promise](https://kelly-kml.github.io/kelly240112.github.io/articles/2024/02/27/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/)

## Generator

### æ˜¯ä»€ä¹ˆï¼Ÿ

æ‰§è¡Œ`Generator`å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå†`Generator`å‡½æ•°å†…éƒ¨çš„æ¯ä¸€ä¸ªçŠ¶æ€
å½¢å¼ä¸Šï¼Œ`Generator`å‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œä½†æ˜¯æœ‰ 2 ä¸ªç‰¹å¾ï¼š

- function å…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ªæ˜Ÿå·
- å‡½æ•°ä½“å†…ä½¿ç”¨`yield`è¡¨è¾¾å¼ï¼Œå®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€

### ä½¿ç”¨

`Generator`å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œå³å…·æœ‰`Symbol.iterator`å±æ€§ï¼Œå¹¶ä¸”è¿”å›ç»™è‡ªå·±

```javascript
function* gen() {
  //...
}

var g = gen();
g[Symbol.iterator]() === g; // true
```

é€šè¿‡`yield`å…³é”®å­—å¯ä»¥æš‚åœ`generator`å‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡çš„çŠ¶æ€

```javascript
function* helloWorldGenerator() {
  yield 'hello';
  yield 'world';
  return 'ending';
}
var hw = helloWorldGenerator();
```

ä¸Šè¿°ä¸‰ç§çŠ¶æ€ï¼š`hello`ã€ `world`ã€ `return`

é€šè¿‡`next`æ–¹æ³•æ‰ä¼šéå†åˆ°ä¸‹ä¸€ä¸ªå†…éƒ¨çŠ¶æ€ï¼Œå…¶è¿è¡Œé€»è¾‘å¦‚ä¸‹ï¼š

- é‡åˆ°`yield`è¡¨è¾¾å¼ï¼Œå°±æš‚åœæ‰§è¡Œåé¢çš„æ“ä½œï¼Œå¹¶å°†ç´§è·Ÿåœ¨`yield`åé¢çš„é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œä½œä¸ºè¿”å›çš„å¯¹è±¡çš„`value`å±æ€§å€¼
- ä¸‹ä¸€æ¬¡è°ƒç”¨`next`æ–¹æ³•æ—¶ï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª`yield`è¡¨è¾¾å¼
- å¦‚æœæ²¡æœ‰å†é‡åˆ°æ–°çš„`yield`è¡¨è¾¾å¼ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°å‡½æ•°ç»“æŸï¼Œç›´åˆ°é‡åˆ°`return`ä¸ºæ­¢ï¼Œå¹¶å°†`return`è¯­å¥åé¢çš„è¡¨è¾¾å¼çš„å€¼ï¼Œä½œä¸ºè¿”å›å¯¹è±¡çš„`value`å±æ€§å€¼
- å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰`return`ï¼Œåˆ™è¿”å›å¯¹è±¡çš„`value`å±æ€§å€¼ä¸º`undefined`

```javascript
hw.next();
// { value: 'hello', done: false }
hw.next();
// { value: 'world', done: false }
hw.next();
// { value: 'ending', done: true }
hw.next();
// { value: undefined, done: true }
```

`done`åˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œ`value`å¯¹åº”çŠ¶æ€å€¼
`yield`æœ¬èº«æ²¡è¿”å›å€¼ï¼Œæˆ–è€…è¯´åªèƒ½è¿”å›`undefined`
é€šè¿‡è°ƒç”¨`next`æ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°å°±ä¼šè¢«å½“åšä¸Šä¸€ä¸ª`yield`è¡¨è¾¾å¼çš„è¿”å›å€¼

```javascript
function* foo(x) {
  var y = 2 * (yield x + 1);
  var z = yield y / 3;
  return x + y + z;
}
var a = foo(5);
a.next(); // Object{value:6, done:false}
a.next(); // Object{value:NaN, done:false}
a.next(); // Object{value:NaN, done:true}
var b = foo(5);
b.next(); // { value:6, done:false }
b.next(12); // { value:8, done:false }
b.next(13); // { value:42, done:true }
```

æ­£å› ä¸º`Generator`è¿”å›`Iterator`å¯¹è±¡ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`for...of`è¿›è¡Œéå†

```javascript
function* foo() {
  yield 1;
  yield 2;
  yield 3;
  yield 4;
  yield 5;
  return 6;
}
for (let v of foo()) {
  console.log(v);
}
// 1 2 3 4 5
```

åŸç”Ÿå¯¹è±¡æ²¡éå†æ¥å£ï¼Œé€šè¿‡`Generator`å‡½æ•°ä¸ºä»–åŠ ä¸Šè¿™ä¸ªæ¥å£ï¼Œå°±èƒ½ä½¿ç”¨`for...of`è¿›è¡Œéå†

```js
function* objectEntries(obj) {
  let propKeys = Reflect.ownKeys(obj);
  for (let propKey of propKeys) {
    yield [propKey, obj[propKey]];
  }
}
let jane = { first: 'Jane', last: 'Doe' };
for (let [key, value] of objectEntries(jane)) {
  console.log(`${key}: ${value}`);
}
// first: Jane
// last: Doe
```

### ä½¿ç”¨åœºæ™¯

`Generator`æ˜¯å¼‚æ­¥è§£å†³çš„ä¸€ç§æ–¹æ¡ˆï¼Œæœ€å¤§ç‰¹ç‚¹åˆ™æ˜¯å°†å¼‚æ­¥æ“ä½œåŒæ­¥åŒ–è¡¨è¾¾å‡ºæ¥

```js
function* loadUI() {
  showLoadingScreen();
  yield loadUIDataAsynchronously();
  hideLoadingScreen();
}
var loader = loadUI();
// åŠ è½½UI
loader.next();

// å¸è½½UI
loader.next();
```

åŒ…æ‹¬`redux-saga`ä¸­é—´ä»¶ä¹Ÿå……åˆ†åˆ©ç”¨äº†`Generator`ç‰¹æ€§

```js
import { call, put, takeEvery, takeLastest } from 'redux-saga/effects';
import Api from '...';
function* fetchUser(action) {
  try {
    const user = yield call(Api.fetchUser, action.payload.userId);
    yield put({ type: 'USER_FETCH_SUCCEEDED', user: user });
  } catch (e) {
    yield put({ type: 'USER_FETCH_FAILED', message: e.message });
  }
}

function* mySaga() {
  yield takeEvery('USER_FETCH_REQUESTED', fetchUser);
}

function* mySaga() {
  yield takeLatest('USER_FETCH_REQUESTED', fetchUser);
}

export default mySaga;
```

è¿˜èƒ½åˆ©ç”¨`Generator` å‡½æ•°ï¼Œåœ¨å¯¹è±¡ä¸Šå®ç°`Iterator`æ¥å£

```js
function* iterEntries(obj) {
  let keys = Object.keys(obj);
  for (let i = 0; i < keys.length; i++) {
    let key = keys[i];
    yield [key, obj[key]];
  }
}

let myObj = { foo: 3, bar: 7 };

for (let [key, value] of iterEntries(myObj)) {
  console.log(key, value);
}

// foo 3
// bar 7
```

## Javascript å¼‚æ­¥ç¼–ç¨‹

Javascript ç¼–ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆæ–¹æ¡ˆï¼Ÿ

**å›ç­”å…³é”®ç‚¹ï¼š**é˜»å¡ã€äº‹ä»¶å¾ªç¯ã€å›è°ƒå‡½æ•°

Javascript æ˜¯ä¸€ç§åŒæ­¥çš„ã€é˜»å¡çš„ã€å•çº¿ç¨‹çš„è¯­è¨€ï¼Œä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚ä½†æ˜¯æµè§ˆå™¨å®šä¹‰äº†éåŒæ­¥çš„ Web APIsï¼Œå°†å›è°ƒå‡½æ•°æ’å…¥åˆ°äº‹ä»¶å¾ªç¯ä¸­ï¼Œå®ç°å¼‚æ­¥ä»»åŠ¡çš„éé˜»å¡æ‰§è¡Œã€‚

å¸¸è§çš„å¼‚æ­¥æ–¹æ¡ˆæœ‰å¼‚æ­¥å›è°ƒã€å®šæ—¶å™¨ã€å‘å¸ƒ/è®¢é˜…æ¨¡å¼ã€Promiseã€ç”Ÿæˆå™¨ Generatorã€async/await ä»¥åŠ Web Workerã€‚

### å¼‚æ­¥å›è°ƒï¼š

- æ˜¯éçº¿æ€§çš„ï¼Œéé¡ºåºçš„ï¼Œç†è§£æˆæœ¬è¾ƒé«˜

- å¤šå±‚åµŒå¥—å›è°ƒä¼šäº§ç”Ÿå›è°ƒåœ°ç‹±

  â€‹

### å®šæ—¶å™¨

`setTimeout` `setInterval` `requestAnimationFrame`éƒ½æ˜¯å¼‚æ­¥æ–¹å¼ã€‚

- setTimeoutï¼šç»è¿‡ä»»æ„æ—¶é—´åè¿è¡Œå‡½æ•°ï¼Œ**é€’å½’ setTimeout åœ¨ JavaScript çº¿ç¨‹ä¸é˜»å¡çš„æƒ…å†µä¸‹å¯ä¿è¯æ‰§è¡Œé—´éš”ç›¸åŒ**ã€‚

- setIntervalï¼šå…è®¸é‡å¤æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå¹¶è®¾ç½®æ—¶é—´é—´éš”ï¼Œ**ä¸èƒ½ä¿è¯æ‰§è¡Œé—´éš”ç›¸åŒ**ã€‚

- requestAnimationFrameï¼šä»¥**å½“å‰æµè§ˆå™¨/ç³»ç»Ÿçš„æœ€ä½³å¸§é€Ÿç‡**é‡å¤ä¸”é«˜æ•ˆåœ°è¿è¡Œå‡½æ•°çš„æ–¹æ³•ã€‚ä¸€èˆ¬ç”¨äºå¤„ç†åŠ¨ç”»æ•ˆæœã€‚

  â€‹

å¦‚æœå½“å‰ Javascript çº¿ç¨‹é˜»å¡ï¼Œè½®åˆ°çš„ setInterval æ— æ³•æ‰§è¡Œï¼Œé‚£ä¹ˆæœ¬æ¬¡ä»»åŠ¡å°±ä¼šè¢«ä¸¢å¼ƒã€‚è€Œ setTimeout è¢«é˜»å¡åä¸ä¼šè¢«ä¸¢å¼ƒï¼Œç­‰åˆ°ç©ºé—²æ—¶ä¼šç»§ç»­æ‰§è¡Œï¼Œä½†æ— æ³•ä¿è¯æ‰§è¡Œé—´éš”ã€‚

### å‘å¸ƒ/è®¢é˜…ï¼š

**å‘å¸ƒ/è®¢é˜…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡é—´ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°çŠ¶æ€æ”¹å˜çš„é€šçŸ¥ã€‚**

### Promise

`Promise` å°±æ˜¯ä¸ºäº†è§£å†³å›è°ƒåœ°ç‹±è€Œäº§ç”Ÿçš„ï¼Œå°†å›è°ƒå‡½æ•°çš„åµŒå¥—ï¼Œæ”¹ä¸ºé“¾å¼è°ƒç”¨ã€‚

Promise æä¾›äº†å®Œæˆå’Œæ‹’ç»ä¸¤ä¸ªçŠ¶æ€æ¥æ ‡è¯†å¼‚æ­¥æ“ä½œç»“æœï¼Œé€šè¿‡ then å’Œ catch å¯ä»¥åˆ†åˆ«å¯¹ç€ä¸¤ä¸ªçŠ¶æ€è¿›è¡Œè·Ÿè¸ªå¤„ç†å’Œäº‹ä»¶ç›‘å¬çš„ä¸»è¦å·®åˆ«åœ¨äºï¼š

ï¼ˆ1ï¼‰ä¸€ä¸ª`Promise`åªèƒ½æˆåŠŸæˆ–å¤±è´¥ä¸€æ¬¡ï¼Œä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±æ— æ³•ä»æˆåŠŸåˆ‡æ¢åˆ°å¤±è´¥ï¼Œåä¹‹äº¦ç„¶ã€‚

ï¼ˆ2ï¼‰å¦‚æœ`Promise`æˆåŠŸæˆ–å¤±è´¥ï¼Œé‚£ä¹ˆå³ä½¿åœ¨äº‹ä»¶å‘ç”Ÿä¹‹åæ·»åŠ æˆåŠŸ/å¤±è´¥å›è°ƒï¼Œä¹Ÿå°†è°ƒç”¨æ­£ç¡®çš„å›è°ƒã€‚

`Promise`ä½¿ç”¨é¡ºåºçš„æ–¹å¼æ¥è¡¨è¾¾å¼‚æ­¥ï¼Œå°†å›è°ƒçš„æ§åˆ¶æƒè½¬äº¤ç»™å¯ä»¥ä¿¡ä»»çš„`Promise.resolve()`ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿä½¿ç”¨é“¾å¼æµçš„æ–¹å¼é¿å…å›è°ƒåœ°ç‹±çš„äº§ç”Ÿï¼Œè§£å†³äº†å¼‚æ­¥å›è°ƒçš„é—®é¢˜ã€‚ä½†æ˜¯`Promise`ä¹Ÿæœ‰ç¼ºé™·ï¼š

ï¼ˆ1ï¼‰é¡ºåºé”™è¯¯å¤„ç†ï¼šå¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼Œ`Promise`é“¾ä¸­çš„é”™è¯¯å¾ˆå®¹æ˜“è¢«å¿½ç•¥ã€‚

ï¼ˆ2ï¼‰å•å†³è®®ï¼š`Promise`åªèƒ½å†³è®®ä¸€æ¬¡ï¼ˆå®Œæˆæˆ–è€…æ‹’ç»)ï¼Œä¸èƒ½å¾ˆå¥½çš„æ”¯æŒå¤šæ¬¡è§¦å‘çš„äº‹ä»¶åŠæ•°æ®æµï¼ˆæ”¯æŒçš„æ ‡å‡†æ­£åœ¨åˆ¶å®šä¸­ï¼‰

ï¼ˆ3ï¼‰æ— æ³•è·å–çŠ¶æ€ï¼šå¤„äº`pending`çŠ¶æ€æ˜¯ï¼Œæ— æ³•å¾—åˆ°ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹å³å°†å®Œæˆï¼‰

ï¼ˆ4ï¼‰æ— æ³•å–æ¶ˆï¼šä¸€æ—¦åˆ›å»ºäº†`Promise`å¹¶æ³¨å†Œäº†å®Œæˆ/æ‹’ç»å‡½æ•°ï¼Œå°±ä¸èƒ½å–æ¶ˆæ‰§è¡Œ

è¯¦ç»†è§£æè¯·ç‚¹å‡»æ­¤å¤„ï¼š[ğŸ‘‰](https://kelly-kml.github.io/kelly240112.github.io/articles/2024/02/27/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/)

å‚è€ƒæ–‡æ¡£ï¼š[æƒ³æƒ³è¯¦ç»†](https://github.com/zcxiaobao/zcBlog/tree/main/promise)

### ç”Ÿæˆå™¨ Generator

`Generator` å‡½æ•°æ˜¯ `ES6` æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œè¯­æ³•ä¸ä¼ ç»Ÿå‡½æ•°å®Œå…¨ä¸åŒï¼Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å¯ä»¥æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œã€‚

`yield` å¯ä»¥æš‚åœå‡½æ•°æ‰§è¡Œï¼Œ`next` ç”¨äºæ¢å¤å‡½æ•°æ‰§è¡Œï¼Œè¿™ä½¿å¾—`Generator`å‡½æ•°éå¸¸é€‚åˆå°†ä¸€éƒ¨ä»»åŠ¡åŒæ­¥åŒ–

```js
function* helloHzfeGenerator() {
  yield 'hello';
  yield 'hzfe';
  return 'ending';
}

var hello = helloHzfeGenerator();

hello.next();
// {value: 'hello', done: false}

hello.next();
// {value: 'hzfe', done: false}

hello.next();
// {value: 'ending', done: true}

hello.next();
// {value: undefined, done: true}
```

Generator å¹¶ä¸æƒ³æ™®é€šå‡½æ•°é‚£æ ·æ€»æ˜¯è¿è¡Œåˆ°ç»“æŸï¼Œå¯ä»¥è¿è¡Œå½“ä¸­é€šè¿‡ yield æ¥æš‚åœå¹¶å®Œå…¨ä¿æŒå…¶çŠ¶æ€ï¼Œå†é€šè¿‡ next æ¢å¤è¿è¡Œã€‚yield/ next ä¸åªæ˜¯æ§åˆ¶æœºåˆ¶ï¼Œä¹Ÿæ˜¯ä¸€ç§åŒå‘æ¶ˆæ¯ä¼ é€’æœºåˆ¶ã€‚yield è¡¨è¾¾å¼æœ¬è´¨ä¸Šæ˜¯æš‚åœä¸‹æ¥ç­‰å¾…æŸä¸ªå€¼ï¼Œnext è°ƒç”¨ä¼šè¢«æš‚åœçš„ yield è¡¨è¾¾å¼ä¼ å›ä¸€ä¸ªå€¼ï¼ˆæˆ–è€…æ˜¯éšå¼çš„ undefined)ã€‚

ç”Ÿæˆå™¨ Generator ä¿æŒäº†é¡ºåºã€åŒæ­¥ã€é˜»å¡çš„ä»£ç æ¨¡å¼ï¼ŒåŒæ ·è§£å†³äº†å¼‚æ­¥å›è°ƒçš„é—®é¢˜ã€‚

### async/await

`await`å†…éƒ¨å®ç°äº†`generator`ï¼Œå…¶å®`await`å…¶å®å°±æ˜¯ Generator + promise çš„è¯­æ³•ç³–ï¼Œä¸”å†…éƒ¨å®ç°äº†è‡ªåŠ¨æ‰§è¡Œ `generator`ã€‚

#### async å‡½æ•°

- å‡½æ•°çš„è¿”å›å€¼ä¸º `promise` å¯¹è±¡
- `promise` å¯¹è±¡çš„ç»“æœç”± `async` å‡½æ•°æ‰§è¡Œçš„è¿”å›å€¼å†³å®š

#### await è¡¨è¾¾å¼

- await å³ä¾§çš„è¡¨è¾¾æ°´ä¸€èˆ¬ä¸º `promise`å¯¹è±¡ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„å€¼
- å¦‚æœè¡¨è¾¾å¼æ˜¯`promise`å¯¹è±¡ï¼Œ`await`è¿”å›çš„å°±æ˜¯`promise`æˆåŠŸçš„å€¼
- å¦‚æœè¡¨è¾¾å¼æ˜¯å…¶å®ƒå€¼, ç›´æ¥å°†æ­¤å€¼ä½œä¸º await çš„è¿”å›å€¼

#### æ³¨æ„

- await å¿…é¡»å†™åœ¨ async å‡½æ•°ä¸­, ä½† async å‡½æ•°ä¸­å¯ä»¥æ²¡æœ‰ await
- å¦‚æœ await çš„ promise å¤±è´¥äº†, å°±ä¼šæŠ›å‡ºå¼‚å¸¸, éœ€è¦é€šè¿‡ `try...catch` æ•è·å¤„ç†

#### çœ‹èµ·æ¥å¼‚æ­¥ä»£ç çœ‹èµ·æ¥æ›´åƒæ˜¯åŒæ­¥ä»£ç ï¼Œå…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š

- `async/await` ä¸èƒ½ç”¨äºæ™®é€šçš„å›è°ƒå‡½æ•°

- `async/await` ä¸ `Promise` ä¸€æ ·ï¼Œæ˜¯éé˜»å¡çš„

- `async/await` ä½¿å¾—å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç 

  â€‹

#### `async/await` ä¹Ÿå­˜åœ¨é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆï¼š

**é—®é¢˜**ï¼š

await å…³é”®å­—ä¼šé˜»å¡å…¶åçš„ä»£ç ï¼Œç›´åˆ° Promise å®Œæˆï¼Œå°±åƒæ‰§è¡ŒåŒæ­¥æ“ä½œä¸€æ ·ã€‚

ä»–ä»¬å¯ä»¥å…è®¸å…¶ä»–ä»»åŠ¡åœ¨æ­¤æœŸé—´ç»§ç»­è¿è¡Œï¼Œä½†æ˜¯è‡ªå·±çš„ä»£ç ä¼šè¢«é˜»å¡ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

å°† Promise å¯¹è±¡å­˜å‚¨åœ¨å˜é‡ä¸­æ¥åŒæ—¶å¼€å§‹ï¼Œç„¶åç­‰å¾…ä»–ä»¬å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚å¦‚æœå†…éƒ¨çš„ await ç­‰å¾…çš„å¼‚æ­¥ä»»åŠ¡ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œä¸”éœ€è¦è·å–è¿™äº›å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥ä½¿ç”¨ Promise.allSettled()åŒæ—¶æ‰§è¡Œè¿™äº›ä»»åŠ¡å¹¶è·å¾—ç»“æœã€‚

```js
function fn1() {
  return Promise.resolve(1);
}
function fn2() {
  return 2;
}
function fn3() {
  return Promise.reject(3);
  // return fn3.test() // ç¨‹åºè¿è¡Œä¼šæŠ›å‡ºå¼‚å¸¸
}
function fn4() {
  return fn3.test(); // ç¨‹åºè¿è¡Œä¼šæŠ›å‡ºå¼‚å¸¸
}
// æ²¡æœ‰ä½¿ç”¨ await çš„ async å‡½æ•°
async function fn5() {
  return 4;
}
async function fn() {
  // await å³ä¾§æ˜¯ä¸€ä¸ªæˆåŠŸçš„ promise

  const result = await fn1();
  // await å³ä¾§æ˜¯ä¸€ä¸ªé promise çš„æ•°æ®
  // const result = await fn2()
  // await å³ä¾§æ˜¯ä¸€ä¸ªå¤±è´¥çš„ promise
  // const result = await fn3()
  // await å³ä¾§æŠ›å‡ºå¼‚å¸¸
  // const result = await fn4()
  console.log('result: ', result);
  return result + 10;
}
async function test() {
  try {
    const result2 = await fn();
    console.log('result2', result2);
  } catch (error) {
    console.log('error', error);
  }
  const result3 = await fn4();
  console.log('result4', result3);
}
test();
```

### Web Worker

ï¼ˆ1ï¼‰**Web Worker ä¸º JavaScript åˆ›é€ äº†å¤šçº¿ç¨‹ç¯å¢ƒ**ï¼Œå…è®¸ä¸»çº¿ç¨‹åˆ›å»º Worker çº¿ç¨‹ï¼Œå°†ä¸€äº›ä»»åŠ¡åˆ†é…ç»™ Worker çº¿ç¨‹è¿è¡Œï¼Œå¤„ç†å®Œåå¯ä»¥é€šè¿‡ postMessage å°†ç»“æœä¼ é€’ç»™ä¸»çº¿ç¨‹ã€‚ä¼˜ç‚¹åœ¨äºå¯ä»¥åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œè´¹æ—¶çš„å¤„ç†ä»»åŠ¡ï¼Œä»è€Œå…è®¸ä¸»çº¿ç¨‹ä¸­çš„ä»»åŠ¡ï¼ˆé€šå¸¸æ˜¯ UIï¼‰è¿è¡Œä¸è¢«é˜»å¡ã€‚

ï¼ˆ2ï¼‰ä½¿ç”¨ Web Worker æ—¶æœ‰ä»¥ä¸‹ä¸‰ç‚¹éœ€è¦æ³¨æ„ï¼š

- **åœ¨ Worker å†…éƒ¨æ— æ³•è®¿é—®ä¸»çº¿ç¨‹çš„ä»»ä½•èµ„æº**ï¼ŒåŒ…æ‹¬å…¨å±€å˜é‡ï¼Œé¡µé¢çš„ DOM æˆ–è€…å…¶ä»–èµ„æºï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„çº¿ç¨‹ã€‚
- **Worker å’Œä¸»çº¿ç¨‹é—´çš„æ•°æ®ä¼ é€’é€šè¿‡æ¶ˆæ¯æœºåˆ¶è¿›è¡Œ**ã€‚ä½¿ç”¨ postMessage æ–¹æ³•å‘é€æ¶ˆæ¯ï¼›ä½¿ç”¨ onmessage äº‹ä»¶å¤„ç†å‡½æ•°æ¥å“åº”æ¶ˆæ¯ã€‚
- **Worker å¯ä»¥åˆ›å»ºæ–°çš„ workerï¼Œæ–°çš„ worker å’Œçˆ¶é¡µé¢åŒæº**ã€‚Worker åœ¨ä½¿ç”¨ XMLHttpRequest è¿›è¡Œç½‘ç»œ I/O æ—¶ï¼ŒXMLHttpRequest çš„ responseXML å’Œ channel å±æ€§ä¼šè¿”å› nullã€‚

ï¼ˆ3ï¼‰Web Worker ä¸»è¦åº”ç”¨åœºæ™¯ï¼š

1. å¤„ç†å¯†é›†å‹æ•°å­¦è®¡ç®—
2. å¤§æ•°æ®é›†æ’åº
3. æ•°æ®å¤„ç†ï¼ˆå‹ç¼©ï¼ŒéŸ³é¢‘åˆ†æï¼Œå›¾åƒå¤„ç†ç­‰ï¼‰
4. é«˜æµé‡ç½‘ç»œé€šä¿¡

### æ€»ç»“ï¼š

#### å›è°ƒå‡½æ•°ï¼ˆsetTimeoutï¼‰

**ç¼ºç‚¹ï¼šäº§ç”Ÿå›è°ƒåœ°ç‹±ï¼Œä¸èƒ½ç”¨`try...catch`æ•è·é”™è¯¯ï¼Œä¸èƒ½ return **

å›è°ƒåœ°ç‹±çš„æ ¹æœ¬é—®é¢˜åœ¨äºï¼š

- ç¼ºä¹é¡ºåºæ€§ï¼šå›è°ƒåœ°ç‹±å¯¼è‡´çš„è°ƒè¯•å›°éš¾ï¼Œå’Œå¤§è„‘çš„æ€ç»´æ–¹å¼ä¸ç¬¦
- åµŒå¥—å‡½æ•°å­˜åœ¨è€¦åˆæ€§ï¼Œä¸€æ—¦æœ‰æ‰€æ”¹å˜ï¼Œå°±ä¼šç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ï¼Œå³ï¼ˆæ§åˆ¶åè½¬ï¼‰
- åµŒå¥—å‡½æ•°è¿‡å¤šçš„è¯ï¼Œå¾ˆéš¾å¤„ç†é”™è¯¯

**ä¼˜ç‚¹ï¼šè§£å†³äº†åŒæ­¥çš„é—®é¢˜**ï¼ˆåªè¦æœ‰ä¸€ä¸ªä»»åŠ¡è€—æ—¶å¾ˆé•¿ï¼Œåé¢çš„ä»»åŠ¡éƒ½å¿…é¡»æ’é˜Ÿç­‰ç€ï¼Œä¼šæ‹–å»¶æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œã€‚ï¼‰

#### Promise

Promise å°±æ˜¯ä¸ºäº†è§£å†³ callback çš„é—®é¢˜è€Œäº§ç”Ÿçš„ã€‚

Promise å®ç°äº†é“¾å¼è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡ then åè¿”å›çš„éƒ½æ˜¯ä¸€ä¸ªå…¨æ–° Promiseï¼Œå¦‚æœæˆ‘ä»¬åœ¨ then ä¸­ return ï¼Œreturn çš„ç»“æœä¼šè¢« Promise.resolve() åŒ…è£…

**ä¼˜ç‚¹ï¼šè§£å†³äº†å›è°ƒåœ°ç‹±**

**ç¼ºç‚¹ï¼šæ— æ³•å–æ¶ˆ Promise ï¼Œé”™è¯¯éœ€è¦é€šè¿‡å›è°ƒå‡½æ•°æ¥æ•è·**

#### Generator

**ç‰¹ç‚¹ï¼šå¯ä»¥æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œ**ï¼Œå¯ä»¥é…åˆ co å‡½æ•°åº“ä½¿ç”¨

#### async/await

asyncã€await æ˜¯å¼‚æ­¥çš„ç»ˆæè§£å†³æ–¹æ¡ˆ

**ä¼˜ç‚¹ï¼šä»£ç æ¸…æ™°ï¼Œä¸ç”¨åƒ Promise å†™ä¸€å¤§å † then é“¾ï¼Œå¤„ç†äº†å›è°ƒåœ°ç‹±çš„é—®é¢˜**

**ç¼ºç‚¹ï¼šawait å°†å¼‚æ­¥ä»£ç æ”¹é€ æˆåŒæ­¥ä»£ç ï¼Œå¦‚æœå¤šä¸ªå¼‚æ­¥æ“ä½œæ²¡æœ‰ä¾èµ–æ€§è€Œä½¿ç”¨ await ä¼šå¯¼è‡´æ€§èƒ½ä¸Šçš„é™ä½ã€‚**

### âš ï¸ åŒºåˆ«æ³¨æ„ï¼š

- `promise` å’Œ `async/await`æ˜¯ä¸“é—¨ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œçš„
- `Generator` å¹¶ä¸æ˜¯ä¸ºå¼‚æ­¥è€Œè®¾è®¡çš„ï¼Œå®ƒè¿˜æœ‰å…¶ä»–åŠŸèƒ½ï¼ˆå¯¹è±¡è¿­ä»£ã€æ§åˆ¶è¾“å‡ºã€éƒ¨ç½²`Iterator`æ¥å£...ï¼‰
- `promise` ç¼–å†™ä»£ç ç›¸æ¯”`Generator`ã€`async`æ›´ä¸ºå¤æ‚ï¼Œä¸”å¯è¯»æ€§ç¨å·®
- `Generator`ã€ `async`éœ€è¦ä¸`promise`å¯¹è±¡æ­é…å¤„ç†å¼‚æ­¥æƒ…å†µ
- `async`å®è´¨ä¸Šæ˜¯`Generator`çš„è¯­æ³•ç³–ï¼Œç›¸å½“äºä¼šè‡ªåŠ¨æ‰§è¡Œ`Generator`å‡½æ•°
- `async`ä½¿ç”¨ä¸Šæ›´ä¸ºç®€æ´ï¼Œå°†å¼‚æ­¥ä»£ç ä»¥åŒæ­¥çš„å½¢å¼è¿›è¡Œç¼–å†™ï¼Œæ˜¯å¤„ç†å¼‚æ­¥ç¼–ç¨‹çš„æœ€ç»ˆæ–¹æ¡ˆ

## Setã€Map ä¸¤ç§æ–°çš„æ•°æ®ç»“æ„

`Set`æ˜¯ä¸€ç§å«åš`é›†åˆ`çš„æ•°æ®ç»“æ„
`Map`æ˜¯ä¸€ç§å«åš`å­—å…¸`çš„æ•°æ®ç»“æ„

- é›†åˆï¼ˆSetï¼‰

æ˜¯ç”±ä¸€å †æ— åºçš„ã€ç›¸å…³è”çš„ï¼Œä¸”ä¸é‡å¤çš„å†…éƒ¨ç»“æ„ï¼ˆæ•°å­¦ä¸­ç§°ä¸ºå…ƒç´ ï¼‰ç»„æˆçš„ç»„åˆ

- å­—å…¸ï¼ˆMapï¼‰

æ˜¯ä¸€äº›å…ƒç´ çš„é›†åˆã€‚æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªç§°ä¸º key çš„åŸŸï¼Œä¸åŒå…ƒç´ çš„ key å„ä¸ç›¸åŒ

åŒºåˆ«ï¼Ÿ

- å…±åŒç‚¹ï¼šé›†åˆå’Œå­—å…¸éƒ½å¯ä»¥å­˜å‚¨ä¸é‡å¤çš„å€¼

- ä¸åŒç‚¹ï¼šé›†åˆæ˜¯ä»¥[å€¼ï¼Œå€¼]çš„å½¢å¼å­˜å‚¨å…ƒç´ ï¼Œå­—å…¸æ˜¯ä»¥[é”®ï¼Œå€¼]å½¢å¼å­˜å‚¨çš„

### Set

#### Set çš„å®ä¾‹å…³äºå¢åˆ æ”¹æŸ¥çš„æ–¹æ³•

- add()

æ·»åŠ æŸä¸ªå€¼ï¼Œè¿”å› Set ç»“æ„æœ¬èº«

å½“æ·»åŠ çš„å€¼å·²ç»å­˜åœ¨äº†ï¼Œä¸ä¼šäºŒæ¬¡æ·»åŠ ï¼Œå³é›†åˆå†…çš„å…ƒç´ æ˜¯ä¸é‡å¤çš„

- delete()

åˆ é™¤æŸä¸ªå€¼ï¼Œè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºåˆ é™¤æˆåŠŸä¸å¦

- has()

è¿”å›å¸ƒå°”å€¼ï¼Œåˆ¤æ–­è¯¥å€¼æ˜¯å¦ä¸º Set çš„æˆå‘˜

- clear()

æ¸…é™¤æ‰€æœ‰æˆå‘˜ï¼Œæ²¡æœ‰è¿”å›å€¼

#### å®ä¾‹éå†çš„æ–¹æ³•

`Set`éå†é¡ºåºå°±æ˜¯æ’å…¥é¡ºåº

- keys() -- éå†å±æ€§å
- values() -- éå†å±æ€§å€¼
- entries() -- éå†é”®å€¼å¯¹

```js
let set = new Set(['red', 'green', 'blue']);
for (let item of set.keys()) {
  console.log(item);
}
// red
// green
// blue
for (let item of set.values()) {
  console.log(item);
}
// red
// green
// blue
for (let item of set.entries()) {
  console.log(item);
}
// ["red", "red"]
// ["green", "green"]
// ["blue", "blue"]
```

- forEach()

ç”¨äºå¯¹æ¯ä¸ªæˆå‘˜æ‰§è¡ŒæŸç§æ“ä½œï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œé”®å€¼ã€é”®åéƒ½ç›¸ç­‰ï¼ŒåŒæ ·çš„`forEach`æ–¹æ³•æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šå¤„ç†å‡½æ•°çš„`this`

```javascript
let set = new Set([1, 4, 9]);
set.forEach((value, key) => console.log(key + ' : ' + value));
// 1 : 1
// 4 : 4
// 9 : 9
```

#### åº”ç”¨åœºæ™¯

- æ‰©å±•è¿ç®—ç¬¦å’Œ`Set`ç»“æ„ç›¸ç»“åˆå¯ä»¥å®ç°æ•°ç»„æˆ–å­—ç¬¦ä¸²å»é‡

```javascript
// æ•°ç»„
let arr = [3, 5, 2, 2, 5, 5];
let unique = [...new Set(arr)]; // [3, 5, 2]

// å­—ç¬¦ä¸²
let str = '352255';
let unique = [...new Set(str)].join(''); // "352"
```

- å®ç°å¹¶é›†ã€äº¤é›†å’Œå·®é›†

```js
let a = new Set([1, 2, 3]);
let b = new Set([4, 3, 2]);

//å¹¶é›†
let union = new Set([...a, ...b]);
// Set {1, 2, 3, 4}

//äº¤é›†
let intersect = new Set([...a].filter((x) => b.has(x)));
// set {2, 3}

// aç›¸å¯¹äº bçš„å·®é›†
let difference = new Set([...a].filter((x) => !b.has(x)));
// Set {1}
```

### Map

`Map`ç±»å‹æ—¶é”®å€¼å¯¹çš„æœ‰åºåˆ—è¡¨ï¼Œè€Œé”®å’Œå€¼éƒ½å¯ä»¥æ˜¯ä»»æ„ç±»å‹
`Map`æœ¬èº«æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ`Map`æ•°æ®ç»“æ„

#### å®ä¾‹å…³äºå¢åˆ æ”¹æŸ¥çš„å±æ€§å’Œæ“ä½œæ–¹æ³•

- size()
  è¿”å› `Map` ç»“æ„çš„æˆå‘˜æ€»æ•°

```js
const map = new Map();
map.set('foo', true);
map.set('bar', false);
map.size; // 2
```

- set()

è®¾ç½®é”®å key å¯¹åº”çš„é”®å€¼ä¸º valueï¼Œç„¶åè¿”å›æ•´ä¸ª Map ç»“æ„
å¦‚æœ key å·²ç»æœ‰å€¼ï¼Œåˆ™é”®å€¼ä¼šè¢«æ›´æ–°ï¼Œå¦åˆ™å°±æ–°ç”Ÿæˆè¯¥é”®
åŒæ—¶è¿”å›çš„æ˜¯å½“å‰ Map å¯¹è±¡ï¼Œå¯é‡‡ç”¨é“¾å¼å†™æ³•

```js
const m = new Map();
m.set('edition', 6); // é”®æ˜¯å­—ç¬¦ä¸²
m.set(262, 'standard'); // é”®æ˜¯æ•°å€¼
m.set(undefined, 'nah'); // é”®æ˜¯ undefined
m.set(1, 'a').set(2, 'b').set(3, 'c'); //é“¾å¼æ“ä½œ
```

- get()
  ç”¨äºè¯»å– key å¯¹åº”çš„é”®å€¼ï¼Œå¦‚æœæ‰¾ä¸åˆ° keyï¼Œå°±è¿”å› undefined

```js
const m = new Map();
const hello = function () {
  console.log('hello');
};
m.set(hello, 'Hello ES6!'); // é”®æ˜¯å‡½æ•°
m.get(hello); // Hello ES6!
```

- has()
  è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªé”®æ˜¯å¦å­˜åœ¨å½“å‰ Map å¯¹è±¡ä¸­

```js
const m = new Map();
m.set('edition', 6);
m.set(262, 'standard');
m.set(undefined, 'nah');
m.has('edition'); // true
m.has('years'); // false
m.has(262); // true
m.has(undefined); // true
```

- delete()
  ç”¨äºåˆ é™¤æŸä¸ªé”®ï¼Œå¤±è´¥è¿”å›`false`

- clear()
  ç”¨äºæ¸…é™¤æ‰€æœ‰æˆå‘˜ï¼Œæ²¡è¿”å›å€¼

#### å®ä¾‹éå†çš„æ–¹æ³•

`Map`éå†é¡ºåºå°±æ˜¯æ’å…¥é¡ºåº

- keys() -- éå†é”®åçš„éå†å™¨
- values() -- éå†é”®å€¼çš„éå†å™¨
- entries() -- éå†é”®å€¼å¯¹çš„éå†å™¨
- forEach() -- éå†æ‰€æœ‰æˆå‘˜

```js
const map = new Map([
  ['F', 'no'],
  ['T', 'yes'],
]);
for (let key of map.keys()) {
  console.log(key);
}
// "F"
// "T"

for (let value of map.values()) {
  console.log(value);
}
// "no"
// "yes"

for (let item of map.entries()) {
  console.log(item[0], item[1]);
}
// "F" "no"
// "T" "yes"

// æˆ–è€…
for (let [key, value] of map.entries()) {
  console.log(key, value);
}
// "F" "no"
// "T" "yes"

// ç­‰åŒäºä½¿ç”¨ map.entries()
for (let [key, value] of map) {
  console.log(key, value);
}
// "F" "no"
// "T" "yes"

map.forEach(function (value, key, map) {
  console.log('Key: %s, Value: %s', key, value);
});
```

### WeakSet å’Œ WeakMap

#### WeakSet

åˆ›å»º WeakSet å®ä¾‹ï¼š

```javascript
const ws = new WeakSet();
```

`WeakSet`å¯ä»¥æ¥å—ä¸€ä¸ªå…·æœ‰`Iterator`æ¥å£çš„å¯¹è±¡ä½œä¸ºå‚æ•°

```javascript
const a = [
  [1, 2],
  [3, 4],
];
const ws = new WeakSet(a);
// WeakSet {[1, 2], [3, 4]}
```

åœ¨ API ä¸­ WeakSet ä¸ Set æœ‰ä¸¤ä¸ªåŒºåˆ«ï¼š

- æ²¡æœ‰éå†æ“ä½œçš„ API
- æ²¡æœ‰`size`å±æ€§

`WeakSet`æˆå‘˜åªèƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼Œè€Œä¸èƒ½æ˜¯å…¶ä»–ç±»å‹çš„å€¼

```javascript
let ws = new WeakSet();

// æˆå‘˜ä¸æ˜¯å¼•ç”¨ç±»å‹
let weakSet = new WeakSet([2, 3]);
console.log(weakSet); // æŠ¥é”™

// æˆå‘˜ä¸ºå¼•ç”¨ç±»å‹
let obj1 = { name: 1 };
let obj2 = { name: 1 };
let ws = new WeakSet([obj1, obj2]);
console.log(ws); //WeakSet {{â€¦}, {â€¦}}
```

`WeakSet`é‡Œé¢çš„å¼•ç”¨åªè¦åœ¨å¤–éƒ¨æ¶ˆå¤±ï¼Œå¥¹åœ¨ WeakSet é‡Œé¢çš„å¼•ç”¨å°±ä¼šè‡ªåŠ¨æ¶ˆå¤±

#### WeakMap

åœ¨ API ä¸­`WeakMap` å’Œ`Map`æœ‰ä¸¤ä¸ªåŒºåˆ«ï¼š

- æ²¡æœ‰éå†æ“ä½œçš„ API
- æ²¡æœ‰`clear`æ¸…ç©ºæ–¹æ³•

```js
// WeakMapå¯ä»¥ä½¿ç”¨ setæ–¹æ³•æ·»åŠ æˆå‘˜
const wm1 = new WeakMap();
const key = { foo: 1 };
wm1.set(key, 2);
wm1.get(key); // 2

// WeakMap ä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ªæ•°ç»„
// ä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°
const k1 = [1, 2, 3];
const k2 = [4, 5, 6];
const wm2 = new WeakMap([
  [k1, 'foo'],
  [k2, 'bar'],
]);
wm2.get(k2); // "bar"
```

`WeakMap`åªæ¥å—å¯¹è±¡ä½œä¸ºé”®åï¼ˆnull é™¤å¤–ï¼‰ï¼Œä¸æ¥å—å…¶ä»–ç±»å‹çš„å€¼ä½œä¸ºé”®å

```js
const map = new WeakMap();
map.set(1, 2);
// TypeError: 1 is not an object!
map.set(Symbol(), 2);
// TypeError: Invalid value used as weak map key
map.set(null, 2);
// TypeError: Invalid value used as weak map key
```

`WeakMap`çš„é”®åæ‰€æŒ‡å‘çš„å¯¹è±¡ï¼Œä¸€æ—¦ä¸åœ¨éœ€è¦ï¼Œé‡Œé¢çš„é”®åå¯¹è±¡å’Œæ‰€å¯¹åº”çš„é”®å€¼å¯¹ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œä¸ç”¨æ‰‹åŠ¨åˆ é™¤å¼•ç”¨

ä¸¾ä¸ª ğŸŒ°

å½“ç½‘é¡µçš„ DOM å…ƒç´ ä¸Šæ·»åŠ æ•°æ®ï¼Œå°±å¯ä½¿ç”¨ WeakMap ç»“æ„ï¼Œå½“è¯¥ DOM å…ƒç´ è¢«æ¸…é™¤ï¼Œå…¶å¯¹åº”çš„ WeakMap è®°å½•å°±ä¼šè‡ªåŠ¨è¢«ç§»é™¤

```js
const wm = new WeakMap();
const element = document.getElementById('example');
wm.set(element, 'some information');
wm.get(element); // "some information"
```

æ³¨æ„ï¼š`WeakMap`å¼±å¼•ç”¨çš„åªæ˜¯é”®åï¼Œè€Œä¸æ˜¯é”®å€¼ã€‚é”®å€¼ä¾ç„¶æ˜¯æ­£å¸¸å¼•ç”¨

ä¸‹é¢ä»£ç ä¸­ï¼Œé”®å€¼ä¼šåœ¨ WeakMap äº§ç”Ÿæ–°çš„å¼•ç”¨ï¼Œå½“ä½ ä¿®æ”¹ obj ä¸ä¼šå½±å“åˆ°å†…éƒ¨

```js
const wm = new WeakMap();
let key = {};
let obj = { foo: 1 };
wm.set(key, obj);
obj = null;
wm.get(key);
// Object {foo: 1}
```

## proxy

### å¦‚ä½•ä½¿ç”¨ï¼š

`proxy`æ˜¯æ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ`proxy`å®ä¾‹

```js
var proxy = new Proxy(target, handler);
```

#### å‚æ•°å¦‚ä¸‹ï¼š

`target` è¡¨ç¤ºæ‰€æœ‰æ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡ï¼ˆä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬åŸç”Ÿæ•°ç»„ã€å‡½æ•°ï¼Œç”šè‡³å¦ä¸€ä¸ªä»£ç†ï¼‰
`handler`é€šå¸¸ä»¥å‡½æ•°ä½œä¸ºå±æ€§çš„å¯¹è±¡ï¼Œå„å±æ€§ä¸­çš„å‡½æ•°åˆ†åˆ«å®šä¹‰äº†åœ¨æ‰§è¡Œå„ç§æ“ä½œæ—¶ä»£ç†`p`çš„è¡Œä¸º

#### handler æ‹¦æˆªå±æ€§å¦‚ä¸‹ï¼š

- get(target, propKey, receiver):æ‹¦æˆªå¯¹è±¡å±æ€§çš„è¯»å–
- set(target, propKey, value, receiver):æ‹¦æˆªå¯¹è±¡å±æ€§çš„è®¾ç½®
- has(target, propKey):æ‹¦æˆª`propKey in proxy`çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- deleteProperty(target, propKey):æ‹¦æˆª`delete proxy[propKey]`çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- ownKeys(target):æ‹¦æˆª Object.keys(proxy)ã€for...in ç­‰å¾ªç¯ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„
- getOwnPropertyDescriptor(target, propKey):æ‹¦æˆª`Object.getOwnPropertyDescriptor(proxy,propKey)`ï¼Œè¿”å›å±æ€§çš„æè¿°å¯¹è±¡
- defineProperty(target, propKey, propDesc)ï¼šæ‹¦æˆª`Object.defineProperty(target, propKey, propDesc)`ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- preventExtensions(target):æ‹¦æˆª`preventExtensions(proxy)`ï¼Œè¿”å›å¸ƒå°”å€¼
- getPrototypeOf(target):æ‹¦æˆª`Object.getPrototypeOf(proxy)`ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡
- isExtensible(target): æ‹¦æˆª`Object.isExtensible(proxy)`ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- setPrototypeOf(target,proto): æ‹¦æˆª`Object.setPrototypeOf(proxy,proto)`ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼
- apply(target, object, args):æ‹¦æˆª`Proxy`å®ä¾‹ä½œä¸ºå‡½æ•°è°ƒç”¨çš„æ“ä½œ
- construct(target, args): æ‹¦æˆª`Proxy`å®ä¾‹ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨çš„æ“ä½œ

#### Reflect

è‹¥éœ€è¦åœ¨`Proxy`å†…éƒ¨è°ƒç”¨å¯¹è±¡çš„é»˜è®¤è¡Œä¸ºï¼Œå»ºè®®ä½¿ç”¨`Reflect`ï¼Œå…¶å®æ˜¯ ES6 ä¸­æ“ä½œå¯¹è±¡æä¾›çš„æ–°`API`

å…¶åŸºæœ¬ç‰¹ç‚¹ï¼š

- åªè¦`Proxy`å¯¹è±¡å…·æœ‰çš„ä»£ç†æ–¹æ³•ï¼Œ`Reflect`å¯¹è±¡å…¨éƒ¨å…·æœ‰ï¼Œä»¥é™æ€æ–¹æ³•çš„å½¢å¼å­˜åœ¨
- ä¿®æ”¹æŸäº› Object æ–¹æ³•çš„è¿”å›ç»“æœï¼Œè®©å…¶å˜å¾—åˆç†ï¼ˆå®šä¹‰ä¸å­˜åœ¨å±æ€§è¡Œä¸ºæ—¶ä¸æŠ¥é”™è€Œæ˜¯è¿”å›`false`ï¼‰
- è®©`Object`æ“ä½œéƒ½å˜æˆå‡½æ•°è¡Œä¸º

#### Proxy çš„å‡ ç§ç”¨æ³•

- get()

æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºç›®æ ‡å¯¹è±¡ã€å±æ€§åå’Œ proxy æœ¬èº«ï¼Œæœ€åä¸€ä¸ªå‚æ•°å¯é€‰

```js
var person = {
  name: 'å¼ ä¸‰',
};
var proxy = new Proxy(person, {
  get: function (target, propKey) {
    return Reflect.get(target, propKey);
  },
});
proxy.name; // "å¼ ä¸‰"
```

`get`èƒ½å¯¹æ•°ç»„å¢åˆ æ”¹æŸ¥è¿›è¡Œæ‹¦æˆªï¼Œä¸‹é¢æ˜¯è¯»å–æ•°ç»„è´Ÿå€¼çš„ç´¢å¼•

```js
function createArray(...elements) {
  let handler = {
    get(target, propKey, receiver) {
      let index = Number(propKey);
      if (index < 0) {
        propKey = String(target.length + index);
      }
      return Reflect.get(target, propKey, receiver);
    },
  };
  let target = [];
  target.push(...elements);
  return new Proxy(target, handler);
}
let arr = createArray('a', 'b', 'c');
arr[-1]; // c
```

âš ï¸ æ³¨æ„ï¼šå¦‚æœä¸€ä¸ªå±æ€§ä¸å¯é…ç½®ä¸”ä¸å¯å†™ï¼Œåˆ™`proxy`ä¸èƒ½ä¿®æ”¹è¯¥å±æ€§ï¼Œå¦åˆ™ä¼šæŠ¥é”™

```javascript
const target = Object.defineProperties(
  {},
  {
    foo: {
      value: 123,
      writable: false,
      configurable: false,
    },
  }
);
const handler = {
  get(target, propKey) {
    return 'abc';
  },
};
const proxy = new Proxy(target, handler);
proxy.foo;
// TypeError: Invariant check failed
```

- set()

ç”¨æ¥æ‹¦æˆªæŸä¸ªå±æ€§çš„èµ‹å€¼æ“ä½œï¼Œå¯ä»¥æ¥å—å››ä¸ªå‚æ•°ï¼šä¾æ¬¡ä¸ºç›®æ ‡å¯¹è±¡ã€å±æ€§åã€å±æ€§å€¼å’Œ Proxy æœ¬èº«

å‡è®¾`Person`å¯¹è±¡æœ‰ä¸€ä¸ª age å±æ€§ï¼Œè¯¥å±æ€§åº”è¯¥æ˜¯ä¸€ä¸ªä¸å¤§äº 200 çš„æ•´æ•°ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ Proxy ä¿è¯ age çš„å±æ€§å€¼ç¬¦åˆè¦æ±‚

```js
let validator = {
  set: function (obj, prop, value) {
    if (prop === 'age') {
      if (!Number.isInteger(value)) {
        throw new TypeError('The age is not an integer');
      }
      if (value > 200) {
        throw new RangeError('The age seems invalid');
      }
    }
    // å¯¹äºæ»¡è¶³æ¡ä»¶çš„ageå±æ€§ä»¥åŠå…¶ä»–å±æ€§ï¼Œä¼šç›´æ¥ä¿å­˜
    obj[prop] = value;
  },
};
let person = new Proxy({}, validator);
person.age = 100;
person.age; // 100
person.age = 'young'; // æŠ¥é”™
person.age = 300; // æŠ¥é”™
```

å¦‚æœç›®æ ‡å¯¹è±¡è‡ªèº«çš„æŸä¸ªå±æ€§ï¼Œä¸å¯å†™ä¸”ä¸å¯é…ç½®ï¼Œé‚£ä¹ˆ`set`æ–¹æ³•å°†ä¸èµ·ä½œç”¨

```javascript
const obj = {};
Object.defineProperty(obj, 'foo', {
  value: 'bar',
  writable: false,
});
const handler = {
  set: function (obj, prop, value, receiver) {
    obj[prop] = 'baz';
  },
};
const proxy = new Proxy(obj, handler);
proxy.foo = 'baz';
proxy.foo; // "bar"
```

åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œ`set` ä»£ç†å¦‚æœæ²¡æœ‰è¿”å›`true`ï¼Œå°±ä¼šæŠ¥é”™

```javascript
'use strict';
const handler = {
  set: function (obj, prop, value, receiver) {
    obj[prop] = receiver;
    // æ— è®ºæœ‰æ²¡æœ‰ä¸‹é¢è¿™ä¸€è¡Œï¼Œéƒ½ä¼šæŠ¥é”™
    return false;
  },
};
const proxy = new Proxy({}, handler);
proxy.foo = 'bar';
// TypeError: 'set' on proxy: trap returned falsish for property 'foo'
```

- deleteProperty()

ç”¨äºæ‹¦æˆª `delete`æ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•æŠ›å‡ºé”™è¯¯æˆ–è€…è¿”å›`false`ï¼Œå½“å‰å±æ€§å°±æ— æ³•è¢«åˆ é™¤

```javascript
var handler = {
  deleteProperty(target, key) {
    invariant(key, 'delete');
    Reflect.deleteProperty(target, key);
    return true;
  },
};

function invariant(key, action) {
  if (key[0] == '_') {
    throw new Error('æ— æ³•åˆ é™¤ç§æœ‰å±æ€§');
  }
}

var target = { _prop: 'foo' };
var proxy = new Proxy(target, handler);
delete proxy._prop;
// Error:æ— æ³•åˆ é™¤ç§æœ‰å±æ€§
```

âš ï¸ æ³¨æ„ï¼šç›®æ ‡å¯¹è±¡è‡ªèº«çš„ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰çš„å±æ€§ï¼Œä¸èƒ½è¢«`deleteProperty`æ–¹æ³•åˆ é™¤ï¼Œå¦åˆ™æŠ¥é”™

- revocable()

ç”¨äºå–æ¶ˆä»£ç†

```js
Proxy.revocable(target, handler);
```

### ä½¿ç”¨åœºæ™¯ï¼š

`Proxy`å…¶åŠŸèƒ½éå¸¸ç±»ä¼¼äºè®¾è®¡æ¨¡å¼ä¸­çš„ä»£ç†æ¨¡å¼ï¼Œå¸¸ç”¨åŠŸèƒ½å¦‚ä¸‹ï¼š

- æ‹¦æˆªå’Œç›‘è§†å¤–éƒ¨å¯¹è±¡çš„è®¿é—®
- é™ä½å‡½æ•°æˆ–ç±»çš„å¤æ‚åº¦
- åœ¨å¤æ‚æ“ä½œå‰å¯¹æ“ä½œè¿›è¡Œæ ¡éªŒæˆ–å¯¹æ‰€éœ€èµ„æºè¿›è¡Œç®¡ç†

ä½¿ç”¨ Proxy ä¿éšœæ•°æ®ç±»å‹çš„å‡†ç¡®æ€§

```js
let numericDataStore = { count: 0, amount: 1234, total: 14 };
numericDataStore = new Proxy(numericDataStore, {
  set(target, key, value, proxy) {
    if (typeof value !== 'number') {
      throw Error('å±æ€§åªèƒ½æ˜¯ number ç±»å‹');
    }
    return Reflect.set(target, key, value, proxy);
  },
});
numericDataStore.count = 'foo';
// Error: å±æ€§åªèƒ½æ˜¯ number ç±»å‹
numericDataStore.count = 333;
```

å£°æ˜äº†ä¸€ä¸ªç§æœ‰`apiKey`ï¼Œä¾¿äº api è¿™ä¸ªå¯¹è±¡å†…éƒ¨çš„æ–¹æ³•è°ƒç”¨ï¼Œä½†æ˜¯ä¸å¸Œæœ›ä»å¤–éƒ¨ä¹Ÿèƒ½è®¿é—® api\apiKey

```js
let api = {
  _apiKey: '123abc456def',
  getUsers: function () {},
  getUser: function (userId) {},
  setUser: function (userId, config) {},
};
const RESTRICTED = ['_apiKey'];
api = new Proxy(api, {
  get(target, key, proxy) {
    if (RESTRICTED.indexOf(key) > -1) {
      throw Error(`${key} ä¸å¯è®¿é—®.`);
    }
    return Reflect.get(target, key, proxy);
  },
  set(target, key, value, proxy) {
    if (RESTRICTED.indexOf(key) > -1) {
      throw Error(`${key} ä¸å¯ä¿®æ”¹`);
    }
    return Reflect.get(target, key, value, proxy);
  },
});
console.log(api._apiKey);
api._apiKey = '987654321';
```

è¿˜èƒ½é€šè¿‡ä½¿ç”¨ Proxy å®ç°è§‚å¯Ÿè€…æ¨¡å¼

è§‚å¯Ÿè€…æ¨¡å¼æŒ‡çš„æ˜¯å‡½æ•°è‡ªåŠ¨è§‚å¯Ÿæ•°æ®å¯¹è±¡ï¼Œä¸€æ—¦å¯¹è±¡å‘ç”Ÿæ”¹å˜ï¼Œå‡½æ•°å°±ä¼šè‡ªåŠ¨æ‰§è¡Œ`observable`å‡½æ•°è¿”å›ä¸€ä¸ªåŸå§‹å¯¹è±¡çš„ Proxy ä»£ç†ï¼Œæ‹¦æˆªèµ‹å€¼æ“ä½œï¼Œè§¦å‘å……å½“è§‚å¯Ÿè€…çš„å„ä¸ªå‡½æ•°

```javascript
const queuedObservers = new Set();
const observe = (fn) => queuedObservers.add(fn);
const observable = (obj) => new Proxy(obj, { set });
function set(target, key, value, receiver) {
  const result = Reflect.set(target, key, value, receiver);
  queuedObservers.forEach((observer) => observer());
  return result;
}
```

è§‚å¯Ÿè€…å‡½æ•°éƒ½æ”¾è¿› Set é›†åˆï¼Œå½“ä¿®æ”¹ obj çš„å€¼ï¼Œéƒ½ä¼š set å‡½æ•°ä¸­æ‹¦æˆªï¼Œè‡ªåŠ¨æ‰§è¡Œ Set æ‰€æœ‰çš„è§‚å¯Ÿè€…

## ç†è§£ ES6 ä¸­ Decorator çš„ï¼Ÿæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯å‘¢ï¼Ÿ

### æ˜¯ä»€ä¹ˆï¼Ÿ

`Decorator` å³è£…é¥°å™¨
ç®€å•æ¥è¯´ï¼Œè£…é¥°è€…æ¨¡å¼å°±æ˜¯ä¸€ç§åœ¨ä¸æ”¹å˜åŸç±»å’Œä½¿ç”¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°æ‰©å±•å¯¹è±¡åŠŸèƒ½çš„è®¾è®¡ç†è®ºã€‚
`ES6`ä¸­`Decorator`åŠŸèƒ½äº¦æ˜¯å¦‚æ­¤ï¼Œå…¶æœ¬è´¨ä¹Ÿä¸æ˜¯ä»€ä¹ˆé«˜å¤§ä¸Šçš„ç»“æ„ï¼Œå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œç”¨äºæ‰©å±•ç±»å±æ€§å’Œç±»æ–¹æ³•

è¿™é‡Œå®šä¹‰ä¸€ä¸ªå£«å…µï¼Œè¿™æ—¶ä»–ä»€ä¹ˆè£…å¤‡éƒ½æ²¡æœ‰

```js
class soldier {}
```

å®šä¹‰ä¸€ä¸ªå¾—åˆ° AK è£…å¤‡çš„å‡½æ•°ï¼Œå³è£…é¥°å™¨

```js
function strong(target) {
  target.AK = true;
}
```

ä½¿ç”¨è¯¥è£…é¥°å™¨å¯¹å£«å…µè¿›è¡Œå¢å¼º

```js
@strong
class soldier {}
```

è¿™æ—¶å€™å£«å…µå°±æœ‰æ­¦å™¨äº†

```js
soldier.AK;
```

ä¸Šè¿°ä»£ç è™½ç„¶ç®€å•ï¼Œä½†æ˜¯ä¹Ÿèƒ½å¤Ÿæ¸…æ™°çœ‹åˆ°äº†ä½¿ç”¨`Decorator`çš„ä¸¤å¤§ä¼˜ç‚¹äº†ï¼š

- ä»£ç å¯è¯»æ€§å˜å¼ºäº†ï¼Œè£…é¥°å™¨å‘½åç›¸å½“äºä¸€ä¸ªæ³¨é‡Š
- åœ¨ä¸æ”¹å˜åŸæœ‰ä»£ç æƒ…å†µä¸‹ï¼Œå¯¹åŸæ¥åŠŸèƒ½è¿›è¡Œæ‰©å±•

### å¦‚ä½•ä½¿ç”¨ï¼Ÿ
