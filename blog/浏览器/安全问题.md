## 1. XSS 攻击

（1）概念

XSS 攻击指的是跨脚本攻击，是一种代码注入攻击。攻击者通过在网络注入恶意脚本，使之在用户的浏览器上运行，从而盗取用户的信息如 cookie 等。

XSS 的本质是因为网站没有对恶意代码进行过滤，与正常的代码混合在一起了，浏览器没有办法分辨哪些脚本是可信的，从而导致了恶意代码的执行。

攻击者可以通过这种攻击方式进行以下操作：

- 获取页面的数据，如 DOM、cookie、localStorage;

- DOS 攻击，发送合理请求，占用服务器资源，从而使用户无法访问服务器；

- 破坏页面结构；

- 流量劫持（将链接指向某网站）

（2）攻击类型

XSS 可以分为存储型、反射性和 DOM 型

- **存储型**指的是恶意脚本会存储在目标服务器上，当浏览器请求数据时，脚本从服务器传回执行。

- **反射型**指的是攻击者诱导用户访问一个恶意代码的 URL 时，服务器端接收数据后处理，然后把带有恶意代码的数据发送到浏览器端，浏览器端解析这段带有 XXS 代码的数据后当做脚本执行，最终完成 XSS 攻击。

- **DOM 型**指的是通过修改页面的 DOM 节点形成 XSS。

1） 存储型 XSS 的攻击步骤：

1. 攻击者将恶意代码提交到目标网站的数据库中

2. 用户打开目标网站时，网站服务器端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器

3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行

4. 恶意代码窃取用户数据并且发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作

这种攻击行为常见于**带有用户保存数据的网站**功能，如论坛发帖、商品评论、用户私信等。

2）反射性 XSS 的攻击步骤：

1. 攻击者构造特殊的额 URL，其中包含恶意代码

2. 用户打开带有恶意代码的 URL 时，网站服务器端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器

3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行

4. 恶意代码会窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库⾥，反射型 XSS 的恶意代码存在 URL ⾥。

反射型 XSS 漏洞常⻅于**通过 URL 传递参数**的功能，如⽹站搜索、跳转等。由于需要⽤户主动打开恶意的 URL 才能⽣效，攻击者往往会结合多种⼿段诱导⽤户点击。

3）DOM 型 XSS 的攻击步骤：

1. 攻击者构造特殊的 URL，其中包含恶意代码

2. 用户打开带有恶意代码的 URL

3. 用户浏览器接收到响应后解析执行，前端 Javascript 取出 URL 中的恶意代码并执行

4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

**DOM 型的 XSS 攻击与前两种 XSS 的区别**： DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于**前端 JavaScript 自身的安全漏洞**，而其他两种 XSS 都属于**服务器端的安全漏洞**。

（3）如何防御 XSS？

可以从浏览器的执行来进行预防，一种是使用纯前端的方式，不用服务器端拼接后返回（不使用服务端渲染）。另一种是对需要插入到 HTML 中的代码做好充分的转义。对于 DOM 型的攻击，主要是前端脚本的不可靠而造成的，对于数据获取渲染和字符串拼接的时候应该对可能出现的恶意代码情况进行判断。

使用 CSP ，CSP 的本质是建立一个白名单，告诉浏览器哪些外部资源可以加载和执行，从而防止恶意代码的注入攻击。

- CSP 指的是内容安全策略，它的本质是建立一个白名单，告诉浏览器哪些外部资源可以加载和执行。我们只需要配置规则，如何拦截由浏览器自己来实现。
- 通常有两种方式来开启 CSP ， 一种是设置 HTTP 首部中的 Content-Security-Policy，一种是设置 meta 标签的方式<meta
  http-equiv="Content-Security-Policy">对一些敏感信息进行保护，比如 cookie 使用 http-only，使得脚本无法获取。也可以使用验证码，避免脚本伪装成用户执行一些操作。

## 2. CSRF 攻击

（1）概念

CSRF 攻击指的是跨站请求伪造攻击，攻击者诱导用户进入一个第三方网站，然后该网站向被攻击网站发送跨站请求，如果用户在被攻击网站中保存了登录状态，那么攻击者就可以利用这个登录状态，那么攻击者就可以利用这个登录状态，绕过后台的用户验证，冒充用户向服务器执行一些操作。

CSRF 攻击的本质是利用 cookie 会在同源请求中携带发送给服务器的特点，以此来实现用户的冒充。

（2）攻击类型

常见的 CSRF 攻击有三种：

- GET 类型的 CSRF 攻击，比如在网站中的一个 img 标签里构建一个请求，当用户打开这个网站的时候就会自动发起提交。

- POST 类型的 CSRF 攻击，比如构建一个表单，然后隐藏它，当用户进入页面时，自动提交这个表单。

- 链接类型的 CSRF 攻击，比如在 a 标签的 href 属性里构建一个请求，然后诱导用户去点击。

（3）如何防御 CSRF 攻击

CSRF 攻击可以使用以下方法来防护：

- 进行同源检测，服务器根据 http 请求头中 origin 或者 referer 信息来判断请求是否允许访问的站点，从而对请求进行过滤。当 origin 或者 referer 信息不存在的时候，直接阻止请求。这种方式的缺点是有些情况下 referer 可以被伪造，同时还会吧搜索引擎的链接也给屏蔽了。所以一般网站那个也会允许搜索引擎的页面请求，但是响应的页面请求也会被攻击者给利用。（referer 字段会告诉服务器该网页是从哪个页面链接过来的）

- 使用 CSRF Token 进行验证，服务器向用户返回一个随机数 Token，当网络再次发起请求时，在请求参数中加入服务器端返回的 token，当服务器对这个 token 进行验证。这种方法解决了使用 cookie 单一验证方式时，可能会被冒用的问题，但是这种方法存在一个缺点就是，我们需要给网络中所有的请求都添上了这个 token，操作比较繁琐。还有一个问题是一般不会只有一台网站服务器，如果请求经过负载平衡转移到了其他的服务器，但是这个服务器的 session 中没有保留这个 token 的话，就没办法验证了。这种情况可以通过改变 token 的构建方式来解决。

- 对 Cookie 进行双重验证，服务器在用户访问网站页面时，向请求域名注入一个 cookie，内容为随机字符串，然后当用户再次向服务器发送请求的时候，从 cookie 中取出这个字符串，添加到 URL 参数中，然后服务器通过对 cookie 中的数据和参数进行比较来进行验证。使用这种方式是利用了攻击者只能利用 cookie，但是不能访问获取 cookie 的特点。并且这种方法比 CSRF Token 的方法更加方便，并且不涉及到分布式访问的问题。这种方式的缺点是如果网站存着 XSS 漏洞的，那么这种方式会失败，同时这种方式不能做到子域名的隔离。

- 在设置 cookie 属性的时候设置 Samesite，限制 cookie 不能作为被第三方应用，从而可以避免被攻击者利用。Samesite 一共有两种模式：

（1）严格模式下 cookie 在任何情况下不可能作为第三方 Cookie 使用；

（2）在宽松模式下，cookie 可以被请求时 GET 请求，且会发生页面跳转的请求所用。

## 3. 有哪些可能会引起前端安全的问题？

跨站脚本（Cross-Site Scripting， XSS）：一种代码注入方式，为了与 CSS 区分所以称为 XSS。早期常见于网络论坛，起因是网络没有对用户的输入进行严格的限制，使得攻击者可以将脚本上传到帖子让别人浏览器到有恶意脚本的页面，其注入方式很简单包括但不限于 JavaScript/CSS/Flash 等。

iframe 的滥用：iframe 中的内容是由第三方来提供的，默认情况下他们不受控制，他们在 iframe 中运行 JavaScript 脚本、Flash 插件、弹出对话框等等，这可能会破坏前端用户体验。

跨站点请求伪造（Cross-Site Requests， CSRF）：指的是攻击者通过设置好的陷阱，强制对已完成认证的用户进行非预期的个人信息或设定信息等某些状态更新，属于被动攻击。

恶意第三方库： 无论是后端服务器应用还是前端应用开发，绝大多数时候都在借助开发框架和各种类库进行快速开发，一旦第三方库被植入恶意代码很容易引起安全问题。

## 4. 网络劫持有哪种，如何防范？

网络劫持分为两种：

（1）DNS 劫持：（输入京东被强制跳转到淘宝这就属于 DNS 劫持）

DBS 强制解析：通过修改运营商的本地 DNS 记录，来引导用户流量到缓存服务器

320 跳转的方式：通过监控网络出口的流量，分析判断哪些内容是可以劫持处理的，再对劫持的内存发起 302 跳转的回复，引导用户获取内容。

（2）HTTP 劫持：（访问谷歌但是一直有贪玩蓝月亮的广告），由于 http 明文传输，运营商会修改你的 http 响应内容（即加广告）

（3）DNS 劫持由于涉嫌违法，已经被监管起来，现在很少会有 DNS 劫持，而 http 劫持依然非常盛行，最有效的办法就是全站 HTTPS，将 HTTP 加密，这使得运营商无法获取明文，就无法劫持你的响应内容。
